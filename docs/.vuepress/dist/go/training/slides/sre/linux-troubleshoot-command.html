<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>笔记（更新中...）</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/assets/css/0.styles.e8e4f3a3.css" as="style"><link rel="preload" href="/assets/js/app.47d87362.js" as="script"><link rel="preload" href="/assets/js/2.68b28b64.js" as="script"><link rel="preload" href="/assets/js/41.5757b76e.js" as="script"><link rel="prefetch" href="/assets/js/10.19e51fa6.js"><link rel="prefetch" href="/assets/js/11.0902e843.js"><link rel="prefetch" href="/assets/js/12.1919d69f.js"><link rel="prefetch" href="/assets/js/13.b53be550.js"><link rel="prefetch" href="/assets/js/14.ece08ee7.js"><link rel="prefetch" href="/assets/js/15.7c574079.js"><link rel="prefetch" href="/assets/js/16.fd0735ea.js"><link rel="prefetch" href="/assets/js/17.10f1713a.js"><link rel="prefetch" href="/assets/js/18.7779dc09.js"><link rel="prefetch" href="/assets/js/19.cfe770a3.js"><link rel="prefetch" href="/assets/js/20.6575aefc.js"><link rel="prefetch" href="/assets/js/21.9804d500.js"><link rel="prefetch" href="/assets/js/22.9d3ceebb.js"><link rel="prefetch" href="/assets/js/23.d3d6183a.js"><link rel="prefetch" href="/assets/js/24.171aaa11.js"><link rel="prefetch" href="/assets/js/25.adda0eb8.js"><link rel="prefetch" href="/assets/js/26.e703263e.js"><link rel="prefetch" href="/assets/js/27.99aca3f0.js"><link rel="prefetch" href="/assets/js/28.c6cd6671.js"><link rel="prefetch" href="/assets/js/29.19e834a2.js"><link rel="prefetch" href="/assets/js/3.0f816cc7.js"><link rel="prefetch" href="/assets/js/30.66bd7453.js"><link rel="prefetch" href="/assets/js/31.78feafee.js"><link rel="prefetch" href="/assets/js/32.034d08d7.js"><link rel="prefetch" href="/assets/js/33.27372b63.js"><link rel="prefetch" href="/assets/js/34.513531fc.js"><link rel="prefetch" href="/assets/js/35.fda69aaa.js"><link rel="prefetch" href="/assets/js/36.b36d3c45.js"><link rel="prefetch" href="/assets/js/37.d7f0f07d.js"><link rel="prefetch" href="/assets/js/38.172d9400.js"><link rel="prefetch" href="/assets/js/39.4c718d97.js"><link rel="prefetch" href="/assets/js/4.ad9c62ed.js"><link rel="prefetch" href="/assets/js/40.e114f11d.js"><link rel="prefetch" href="/assets/js/42.6d2d8626.js"><link rel="prefetch" href="/assets/js/43.7eb56563.js"><link rel="prefetch" href="/assets/js/44.89b3f38a.js"><link rel="prefetch" href="/assets/js/45.eabb2e4c.js"><link rel="prefetch" href="/assets/js/46.263f9880.js"><link rel="prefetch" href="/assets/js/47.11635f4b.js"><link rel="prefetch" href="/assets/js/48.ea9f5d80.js"><link rel="prefetch" href="/assets/js/49.879a1176.js"><link rel="prefetch" href="/assets/js/5.fca90c12.js"><link rel="prefetch" href="/assets/js/50.53219c23.js"><link rel="prefetch" href="/assets/js/51.8b49b29f.js"><link rel="prefetch" href="/assets/js/52.86df254b.js"><link rel="prefetch" href="/assets/js/53.a1dfee7a.js"><link rel="prefetch" href="/assets/js/54.6e71a907.js"><link rel="prefetch" href="/assets/js/6.5f0dc3ce.js"><link rel="prefetch" href="/assets/js/7.2c578805.js"><link rel="prefetch" href="/assets/js/8.716094ff.js"><link rel="prefetch" href="/assets/js/9.7e9e980a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e8e4f3a3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">笔记（更新中...）</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Guide
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收录 Menu" class="dropdown-title"><span class="title">收录</span> <span class="arrow down"></span></button> <button type="button" aria-label="收录 Menu" class="mobile-dropdown-title"><span class="title">收录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/收录/go/" class="nav-link">
  Go
</a></li><li class="dropdown-item"><!----> <a href="/收录/gRPC/" class="nav-link">
  gRPC
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Guide
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收录 Menu" class="dropdown-title"><span class="title">收录</span> <span class="arrow down"></span></button> <button type="button" aria-label="收录 Menu" class="mobile-dropdown-title"><span class="title">收录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/收录/go/" class="nav-link">
  Go
</a></li><li class="dropdown-item"><!----> <a href="/收录/gRPC/" class="nav-link">
  gRPC
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>简介</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/profile/profile.html" class="sidebar-link">描述</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Golang</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>gRPC</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Jenkins</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>title: Linux 常用排查命令
speaker: Jerome Ge</p> <slide></slide> <h1 id="linux-常用排查命令"><a href="#linux-常用排查命令" class="header-anchor">#</a> Linux 常用排查命令</h1> <p>Jerome Ge</p> <slide></slide> <h2 id="分类"><a href="#分类" class="header-anchor">#</a> 分类</h2> <ul><li>通用</li> <li>CPU</li> <li>内存</li> <li>磁盘</li> <li>I/O</li> <li>网络</li></ul> <slide></slide> <h3 id="通用"><a href="#通用" class="header-anchor">#</a> 通用</h3> <ul><li>pstree</li> <li>ps</li> <li>htop</li> <li>glances</li> <li>vmstat</li></ul> <slide></slide> <h4 id="pstree"><a href="#pstree" class="header-anchor">#</a> pstree</h4> <p>pstree 命令可以显示正在运行的进程树，可以很直观的看到进程之间的相互关系。命令不指定任何参数，会把系统启动时的第一个进程作为基层，显示基层之后的所有进程。</p> <p>命令用法：</p> <p><code>pstree [选项] [进程号] [用户]</code></p> <p>常用选项：</p> <ul><li>-a 显示命令参数</li> <li>-c 不压缩雷同子进程</li> <li>-p 显示进程号</li> <li>-s 显示指定进程父进程</li></ul> <slide></slide> <h4 id="ps"><a href="#ps" class="header-anchor">#</a> ps</h4> <p>ps 命令是强大的进程查看命令，可以查看进程用户、进程号、资源使用情况、运行状态等信息。</p> <p>命令用法：</p> <p><code>ps [选项]</code></p> <p>常用选项：</p> <ul><li>a 显示带有终端（tty）的所有进程</li> <li>x 显示当前用户的所有进程，连同 a 列出所有进程</li> <li>u 显示面向用户的格式</li> <li>v 显示虚拟内存格式</li> <li>-e 显示全部进程</li> <li>-f 显示完整格式的进程信息</li> <li>-t 显示与终端相关联的所有进程</li> <li>-p 显示进程使用的 cpu 时间</li> <li>-u 显示指定用户的的进程状态</li> <li>-L 显示指定进程的线程</li></ul> <p>最常用的方法是 <code>ps aux</code> 和 <code>ps -ef</code> 列出所有进程后再用 <code>grep</code> 过滤。也可以用 <code>ps -aux --sort -pmem | less</code> 和 <code>ps -aux --sort -pcpu | less</code> 按内存或 CPU 升序查看进程，或使用 <code>ps -aux --sort -pcpu,+pmem | head -n 10</code> 组合命令显示前 10 个资源使用率高进程。</p> <slide></slide> <h4 id="ps-2"><a href="#ps-2" class="header-anchor">#</a> ps</h4> <p>字段含义：</p> <ul><li>USER（UID）：进程所属用户</li> <li>PID：进程号</li> <li>PPID：父进程号</li> <li>%CPU：进程的 CPU 占用率</li> <li>%MEM：进程的内存占用率</li> <li>VSZ：进程使用的虚拟内存的大小，单位是 Kbytes</li> <li>RSS：进程实际使用内存的大小，单位是 Kbytes</li> <li>TTY：与进程关联的终端</li> <li>STAT：进程的状态，使用 STAT 状态码表示</li> <li>STIME：启动时间</li> <li>TIME：进程使用的 CPU 总时间</li> <li>COMMAND（CMD）：执行的命令</li></ul> <slide></slide> <h4 id="ps-3"><a href="#ps-3" class="header-anchor">#</a> ps</h4> <p>STAT 状态：</p> <ul><li>R：运行，正在运行或在运行队列中等待</li> <li>S：中断，休眠中、受阻、在等待某个事件或信号</li> <li>D：不可中断，不可中断的休眠，通常是IO</li> <li>T：停止，进程收到 SIGSTOP、SIGSTP、SIGTIN、SIGTOU 信号后停止运行</li> <li>Z：僵尸，进程已终止，但进程描述符还存在，需等父进程调用 wait4() 系统调用后释放</li> <li>&lt;：高优先级进程</li> <li>N：低优先级进程</li> <li>L：有 pages 在内存中 locked</li> <li>s：进程有子进程</li> <li>l：多线程</li> <li>+：位于前台的进程组</li></ul> <slide></slide> <h4 id="htop"><a href="#htop" class="header-anchor">#</a> htop</h4> <p>htop 是 top 的升级版，上半部分可直观的看到 CPU 核数及使用情况、内存或交换使用情况、进程数（task）、线程数（thread）、load、uptime；下半部分可以看到每个进程或线程的详细信息。</p> <p>字段含义：</p> <ul><li>PID：进程或线程号</li> <li>USER：所属用户</li> <li>PRI：优先级</li> <li>NI：由用户或 root 用户重置的优先级</li> <li>VIR：使用的虚拟内存</li> <li>RES：使用的物理内存</li> <li>SHR：使用的共享内存</li> <li>S：进程的状态</li> <li>CPU%：CPU 占用率</li> <li>MEM%：内存占用率</li> <li>TIME+：开始执行以来的时间</li> <li>Command：执行的命令</li></ul> <p>可以使用 F6 选择不同的列按升级排列；使用 F5 按子父关系显示；使用 F3 进行搜索等。</p> <slide></slide> <h4 id="glances"><a href="#glances" class="header-anchor">#</a> glances</h4> <p>glances 提供了 CPU 使用率、内存和交换使用率、load、磁盘 I/O、磁盘使用率、网络 I/O、容器使用率、进程监控、网页查看等功能，如果有兴趣可以研究下。</p> <slide></slide> <h4 id="vmstat"><a href="#vmstat" class="header-anchor">#</a> vmstat</h4> <p>vmstat 可对操作系统的虚拟内存、进程、CPU 进行监控，可对系统的整体情况进行分析。</p> <p>命令用法：</p> <p><code>vmstat [选项] [间隔 [次数]]</code></p> <p>常用选项：</p> <ul><li>-a 显示活跃和非活跃内存</li> <li>-f 显示系统启动到现在的 fork 数量</li> <li>-m 显示 slabinfo</li> <li>-n 仅显示一次标题</li> <li>-s 显示内存相关统计信息及多种系统活动数量</li> <li>-d 显示磁盘统计信息</li> <li>-D 显示有关磁盘活动的一些摘要统计信息</li> <li>-p 显示指定磁盘分区统计信息</li> <li>-w 宽输出模式</li> <li>-t 将时间戳附加到每行</li></ul> <slide></slide> <h4 id="vmstat-2"><a href="#vmstat-2" class="header-anchor">#</a> vmstat</h4> <p>字段含义：</p> <ul><li>procs
<ul><li>r：正在运行或正在等待运行的进程数</li> <li>b：等待 I/O 的进程数</li></ul></li> <li>memory
<ul><li>swpd：使用的交换内存量</li> <li>free：空闲物理内存量</li> <li>buff：用作缓冲的内存量</li> <li>cache：用作缓存的内存量</li> <li>inact：不活动的内存量</li> <li>active：活动内存量</li></ul></li> <li>swap
<ul><li>si：每秒从交换区写到内存的大小，由磁盘调入内存</li> <li>so：每秒写入交换区的内存大小，由内存调入磁盘</li></ul></li> <li>io
<ul><li>bi：每秒接收的块数</li> <li>bo：每秒写入的块数</li></ul></li> <li>system
<ul><li>in：每秒中断数，包括时钟</li> <li>cs：每秒上下文切换数</li></ul></li> <li>cpu
<ul><li>us：用户进程执行时间百分比</li> <li>sy：系统进程执行时间百分比</li> <li>id：空闲时间百分比</li> <li>wa：I/O 等待时间百分比</li> <li>st：等待宿主机为其他虚拟 CPU 提供服务的时间百分比</li></ul></li></ul> <slide></slide> <h3 id="cpu"><a href="#cpu" class="header-anchor">#</a> CPU</h3> <h4 id="mpstat"><a href="#mpstat" class="header-anchor">#</a> mpstat</h4> <p>可使用 <code>mpstat -P ALL 2 10</code> 命令查看所有 CPU 的统计数据，每 2 秒输出一次，共输出 10 次。</p> <p>字段含义：</p> <ul><li>%usr：用户进程执行时间百分比</li> <li>%nice：执行用户带 nice 优先级的的进程执行时间百分比</li> <li>%sys：系统进程执行时间百分比，不包括硬、软中断</li> <li>%iowait：I/O 等待时间百分比</li> <li>%irq：硬中断的时间百分比</li> <li>%soft：硬中断时间百分比</li> <li>%steal：等待宿主机为其他虚拟 CPU 提供服务的时间百分比</li> <li>%guest：宿主机角度运行虚拟 CPU 的时间百分比</li> <li>%gnice：宿主机角度运行带有 nice 优先级 CPU 的时间百分比</li> <li>%idle：空闲时间百分比</li></ul> <slide></slide> <h3 id="内存"><a href="#内存" class="header-anchor">#</a> 内存</h3> <h4 id="free"><a href="#free" class="header-anchor">#</a> free</h4> <p>统计内存和交换使用情况，可使用 <code>free -h</code> 命令查看，字段含义如下：</p> <ul><li>total：表示物理内存或交换的总大小</li> <li>used：已使用物理内存或交换，不包含 buff/cache</li> <li>free：可用物理内存或交换</li> <li>shared：多个进程共享的内存量</li> <li>buff/cache：缓存量，包含以下内容
<ul><li>buffer：内核缓冲区使用的内存</li> <li>cache：page cache 和 slab 所占用的内存之和，slab 使用可用 <code>slabtop</code> 命令查看</li></ul></li> <li>available：可用物理内存，是 free 加上可回收 page cache 和 slab 值的总和</li></ul> <slide></slide> <h3 id="磁盘"><a href="#磁盘" class="header-anchor">#</a> 磁盘</h3> <ul><li>du</li> <li>df</li> <li>iozone</li></ul> <slide></slide> <h4 id="du"><a href="#du" class="header-anchor">#</a> du</h4> <p>显示目录或文件的大小，查找文件和目录的磁盘使用情况。</p> <p>示例：</p> <ul><li><code>du -sh</code> 统计当前目录的大小，以直观方式展现</li> <li><code>du -sh * | sort - rh</code> 查看目录下文件的大小并按排序</li> <li><code>du -h --max-depth=1 | sort</code> 查看目录下所有一级目录大小并排序</li></ul> <slide></slide> <h4 id="df"><a href="#df" class="header-anchor">#</a> df</h4> <p>显示磁盘分区摘要信息，如分区格式、空间大小、已用空间、可用空间、挂载信息等，一般使用 <code>df -Th</code> 查看。</p> <slide></slide> <h4 id="iozone"><a href="#iozone" class="header-anchor">#</a> iozone</h4> <p>磁盘性能测试工具，可测试磁盘的顺序读写和随机读机速度。常用参数如下：</p> <ul><li>-a 全自动模式，使用的块大小从 4k 到 16M，文件大小从 64k 到 512M</li> <li>-b 输出结果时将创建一个兼容 Excel 的二进格式的文件</li> <li>-c 计算时间时将 clone() 包括进来。</li> <li>-e 计算时间时将 flush（fsync，fflush）包括进来</li> <li>-g 设置自动模式可使用的最大文件大小，单位是 Kbytes</li> <li>-i 用来指定运行哪个测试（0=write/rewrite，1=read/re-read，2=random-read/write，3=Read-backwards，4=Re-write-record，5=stride-read，6=fwrite/re-fwrite，7=fread/Re-fread,8=random mix，9=pwrite/Re-pwrite，10=pread/Re-pread，11=pwritev/Re-pwritev，12=preadv/Re-preadv）</li> <li>-K 在普通测试时生成一些随机访问</li> <li>-n 自动模式设置最小文件大小</li> <li>-N 报告结果以毫秒每操作的方式显示</li> <li>-r 指定测试块大小</li> <li>-s 指定测试文件大小</li> <li>-t 指定测试时使用多少个线程或进程</li> <li>-w 当临时文件使用完毕后不删除</li> <li>-y 设置自动模式下使用的最小块大小</li></ul> <p>示例</p> <p><code>iozone -s 10G -r 4k -i 0 -i 1 -i 2</code> 设置测试文件为 10G，测试块大小为 4K，只测试顺序读写和随机读写。</p> <slide></slide> <h3 id="i-o"><a href="#i-o" class="header-anchor">#</a> I/O</h3> <h4 id="iotop"><a href="#iotop" class="header-anchor">#</a> iotop</h4> <p>iotop 可以显示实时的磁盘活动，监控内核输出的 I/O 使用信息，并显示系统中进程或线程的当前 I/O 使用情况。常用参数如下：</p> <ul><li>-o 只显示正在产生 I/O 的进程或线程，可按 o 切换</li> <li>-n 设置监控显示次数，默认是无限</li> <li>-d 设置显示的间隔秒数</li> <li>-p 只显示指定进程的信息</li> <li>-P 只显示进程，不显示线程，可以按 p 切换</li> <li>-k 使用 KB 为单位显示</li></ul> <p>字段含义：</p> <ul><li>Total DISK READ：进程和线程总的读取量</li> <li>Total DISK WRITE：进程和线程总的写入量</li> <li>Actual DISK READ：内核块设备子系统和磁盘实际磁盘读取量</li> <li>Actual DISK WRITE：内核块设备子系统和磁盘实际磁盘写入量</li> <li>TID：线程或进程号</li> <li>PRIO：运行时的 I/O 优先级</li> <li>USER：所属用户</li> <li>DISK READ：刷新时间间隔内读取量</li> <li>DISK WRITE：刷新时间间隔内写入量</li> <li>SWAPIN：交换使用率</li> <li>IO&gt;：I/O 利用率，包含磁盘和交换</li> <li>COMMAND：执行的命令</li></ul> <slide></slide> <h3 id="网络"><a href="#网络" class="header-anchor">#</a> 网络</h3> <ul><li>iftop</li> <li>telnet</li> <li>curl</li> <li>dig</li> <li>mtr</li> <li>ss</li> <li>netstat</li> <li>tcpdump</li></ul> <slide></slide> <h4 id="iftop"><a href="#iftop" class="header-anchor">#</a> iftop</h4> <p>iftop 可用来统计本机网络流量以及和其他地址通信的实量流量，常用参数如下：</p> <ul><li>-i 指定需要检测的网卡</li> <li>-n 将输出的主机信息都通过 IP 显示</li> <li>-P 显示主机以及端口号</li> <li>-F 显示指定网段的进出流量</li></ul> <p>字段含义：</p> <ul><li>TX：发送的数据量</li> <li>RX：接收的数据量</li> <li>TOTAL：发送和接收的总数据量</li> <li>cum：从 iftop 运行到目前的发送、接收和总数据量</li> <li>peak：发送、接收以及总的峰值</li> <li>rates：过去 2s、10s、40s 的平均值</li></ul> <slide></slide> <h4 id="telnet"><a href="#telnet" class="header-anchor">#</a> telnet</h4> <p>telnet 用于登陆远程主机，对远程主机进行管理，采用明文传输，安全性较差。目前一般用来测试端口的连通性。</p> <p>命令用法：</p> <p><code>telnet [选项] [主机] [端口]</code></p> <slide></slide> <h4 id="curl"><a href="#curl" class="header-anchor">#</a> curl</h4> <p>curl 是在命令行方式下与服务器之间传输文件和数据的工具，支持的协议包含 HTTP、HTTPS、FTP、SMTP、TELNET 等协议。</p> <p>命令用法：</p> <p><code>curl [选项] [URL]</code></p> <p>常用选项：</p> <ul><li>-i 显示 Response 的 Header 信息</li> <li>-I 发送 HEAD 请求并显示 Header 信息</li> <li>-v 输出通信的整个过程，用于调试</li> <li>-k 跳过 SSL 证书检测</li> <li>-w 在请求成功完成后输出指定信息到标准输出，如 DNS 解析时间（time_namelookup），详细内容请参考<a href="https://everything.curl.dev/usingcurl/verbose/writeout#available-write-out-variables" target="_blank" rel="noopener noreferrer">文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>-L 让 HTTP 请求跟随服务器的重定向</li> <li>--limit-rate 限制 HTTP 请求和返回的带宽，模拟网速慢的环境</li> <li>-s 不输出错误和进度信息</li> <li>-X 指定 HTTP method，如 GET、POST、PUT、DELETE</li> <li>-H 设置 Header</li> <li>-e 设置 Referer 值，也可以在 -H 中设置</li> <li>-d 设置 POST 方法的数据体（HTTP Body）</li> <li>-G 使用 GET 方法发送数据体（HTTP Body）</li> <li>-u 设置服务器认证的用户名和密码</li> <li>-b 向服务器发送 Cookie</li> <li>-A 设置 User-Agent 值，也可以在 -H 中设置</li> <li>-C 断点续传</li> <li>-x 设置请求的代理</li> <li>-U 设置代理认证的用户名和密码</li> <li>-o 将输出写入文件</li> <li>-D 将 Header 信息写入指定文件</li></ul> <slide></slide> <h4 id="curl-2"><a href="#curl-2" class="header-anchor">#</a> curl</h4> <p>示例：</p> <ul><li><code>curl -Iv https://www.maiscrm.com</code></li> <li><code>curl -L http://www.maiscrm.com</code></li> <li><code>curl -o maiscrm.html https://www.maiscrm.com</code></li> <li><code>curl -o /dev/null -s -w &quot;time_namelookup: %{time_namelookup}\n&quot; https://www.maiscrm.com</code></li></ul> <slide></slide> <h4 id="dig"><a href="#dig" class="header-anchor">#</a> dig</h4> <p>dig 是一个简单易用的域名解析查询工具。</p> <p>命令用法：</p> <p><code>dig [@域名服务器] [域名] [选项]</code></p> <p>常用选项：</p> <ul><li>-b 指定用本机的哪个 IP 地址向域名服务器发送域名查询请求</li> <li>-f 从文件中读取需要解析的域名列表，每行一个</li> <li>-t 配置查询类型，缺省类型是 A</li> <li>tcp 连接域名服务器时使用 TCP 协议</li> <li>short 显示简要的输出</li></ul> <p>示例：</p> <ul><li><code>dig maiscrm.com</code></li> <li><code>dig maiscrm.com +short</code></li> <li><code>dig maiscrm.com -t txt</code></li></ul> <slide></slide> <h4 id="mtr"><a href="#mtr" class="header-anchor">#</a> mtr</h4> <p>mtr 是一个网络诊断工具，可检查到服务器的每个节点丢包、延迟等原因。</p> <p>命令用法：</p> <p><code>mtr [选项] [域名或IP地址]</code></p> <p>常用选项：</p> <ul><li>-u 使用 UDP 数据包，而不是 ICMP</li> <li>-r 生成报告，只会发送 10 个数据包，如果想要发送更多数据包，可以使用 -c 配置</li> <li>-a 设置发送数据包的 IP 地址</li> <li>-s 指定发送的数据包大小，单位是字节</li> <li>-c 指定发送数据包的数量</li> <li>-4 只使用 IPv4</li></ul> <p>字段含义：</p> <ul><li>Host：到服务器经过的每个节点的 IP 或名称</li> <li>Loss%：对应节点的丢包率</li> <li>Snt：已发送的数据包数量</li> <li>Last：最后一个数据包的响应时间</li> <li>Avg：平均响应时间</li> <li>Best：最短响应时间</li> <li>Wrst：最长响应时间</li> <li>StDev：标准偏差，偏差值越高说明各个数据包在该节点的响应时间相差越大</li></ul> <p>示例：</p> <ul><li><code>mtr maiscrm.com</code></li> <li><code>mtr -r maiscrm.com</code></li></ul> <slide></slide> <h4 id="ss"><a href="#ss" class="header-anchor">#</a> ss</h4> <p>ss 可以获取 socket（套接字） 统计信息，可以显示更多更详继的 TCP 连接状态信息，比 netstat 更快更高效。</p> <p>命令用法：</p> <p><code>ss [选项] [过滤器]</code></p> <p>常用选项：</p> <ul><li>-4 只显示 IPv4 套接字</li> <li>-6 只显示 IPv6 套接字</li> <li>-t 只显示 TCP 套接字</li> <li>-u 只显示 UDP 套接字</li> <li>-d 只显示 DCCP 套接字</li> <li>-w 只显示 RAW 套接字</li> <li>-w 只显示 Unix 套接字</li> <li>-l 显示正监听的套接字</li> <li>-m 使用套接字的内存使用情况</li> <li>-p 显示套接字的进程</li> <li>-a 显示所有套接字信息</li> <li>-s 显示套接字使用概况</li> <li>-D 不显示任何信息，将原始 TCP socket 信息存到指定文件</li> <li>-f 只显示指定类型的 socket，如 unix、inet、inet6、link、netlink</li></ul> <p>示例：</p> <ul><li><code>ss -ta</code> 显示所有 TCP 连接信息</li> <li><code>ss -ua</code> 显示所有 UDP 连接信息</li> <li><code>ss -o state established '(dport = :ssh or sport = :ssh )'</code> 显示状态为 established 的 SSH 连接</li> <li><code>ss -tan|awk 'NR&gt;1{++S[$1]}END{for (a in S) print a,S[a]}'</code> 统计各状态连接信息，状态值含义请阅读 <a href="https://www.masterraghu.com/subjects/np/introduction/unix_network_programming_v1.3/ch02lev1sec6.html" target="_blank" rel="noopener noreferrer">TCP 连接的建立和终止过程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <slide></slide> <h4 id="netstat"><a href="#netstat" class="header-anchor">#</a> netstat</h4> <p>netstat 命令可以用来查看实际网络连接、路由表、网络统计数据等。</p> <p>命令用法：</p> <p><code>netstat [选项]</code></p> <p>常用选项：</p> <ul><li>-a 显示所有连接中的套接字</li> <li>-c 持续列出网络状态</li> <li>-i 显示网络界面信息表单</li> <li>-l 显示监听中的套接字</li> <li>-n 使用 IP 地址显示</li> <li>-r 显示路由表</li> <li>-s 显示网络工作信息统计</li> <li>-t 只显示 TCP 套接字</li> <li>-u 只显示 UDP 套接字</li> <li>-w 只显示 RAM 套接字</li> <li>-v 显示指令执行过程</li></ul> <p>示例：</p> <ul><li><code>netstat -ntl</code> 显示正在监听的 TCP 信息</li> <li><code>netstat -antp | grep ssh</code> 查看 SSH 连接信息</li> <li><code>netstat -an|awk '/^tcp/{++S[$NF]}END{for(a in S) print a,S[a]}'</code> 统计各状态连接信息，状态值含义请阅读 <a href="https://www.masterraghu.com/subjects/np/introduction/unix_network_programming_v1.3/ch02lev1sec6.html" target="_blank" rel="noopener noreferrer">TCP 连接的建立和终止过程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <slide></slide> <h4 id="tcpdump"><a href="#tcpdump" class="header-anchor">#</a> tcpdump</h4> <p>tcpdump 是 Linux 系统上最常用的抓包工具，用来抓取网络通信中的数据包并进行分析。在网络性能急剧下降的时候，可以通过 tcpdump 工具分析原因，找出造成网络阻塞的来源。tcpdump 支持针对网络层、协议、主机、网络接口或端口的过滤，并提供 and、or、not 等逻辑语句过滤不必要的信息。</p> <p>命令用法：</p> <p><code>tcpdump [选项] [-c 数量] [-F 文件名] [-i 网络接口] [-r 文件名] [-s snaplen] [-T 类型] [-w 文件名] [表达式]</code></p> <p>常用选项：</p> <ul><li>-A 以 ASCII 码方式显示每一个数据包，在程序调试时可方便查看数据</li> <li>-a 将网络地址和广播地址转变成名字</li> <li>-c 将接收到指定数目的数据包后退出</li> <li>-d 将匹配信息包的代码以人们能够理解的汇编格式输出</li> <li>-f 将外部的 Internet 地址以数字的形式打印出来</li> <li>-F 使用文件作为过滤条件表达式的输入，命令行上的输入将被忽略</li> <li>-i 指定监听的网络接口</li> <li>-l 使标准输出变为缓冲形式</li> <li>-n 不把网络地址转换为名字</li> <li>-N 不打印出 host 的域名部分</li> <li>-q 打印很少的协议相关信息，从而输出行都比较简短</li> <li>-r 从文件中读取包数据</li> <li>-s 设置数据包抓取长度，默认为 68 字节</li> <li>-t 在输出的每一行不打印时间戳</li> <li>-tt 不对每行输出的时间进行格式处理</li> <li>-ttt 输出时每两行打印之间会延迟一个时间段，以毫秒为单位</li> <li>-v 输出一个稍微详细的信息，例如在 ip 包中可以包括 ttl 和服务类型的信息</li> <li>-vv 输出说细的报文信息</li> <li>-vvv 输出比 -vv 更详细的信息</li></ul> <slide></slide> <h4 id="tcpdump-2"><a href="#tcpdump-2" class="header-anchor">#</a> tcpdump</h4> <p>示例：</p> <ul><li><code>tcpdump -i eth0</code> 抓取 eth0 网卡接口数据包</li> <li><code>tcpdump -i any</code> 抓取所有网卡接口数据包</li> <li><code>tcpdump -i eth0 arp</code> 基于协议抓取数据包</li> <li><code>tcpdump -w /path/to/file.pcap</code> 保存数据包信息到文件，可用 wirshark 打开分析</li> <li><code>tcpdump -n -i eth0 net 192.168.2.2 and port 53</code> 抓取指定地址和端口的网络数据包</li> <li><code>tcpdump -n -i eth0 src 192.168.2.3 and port 80</code> 抓取指定源定地和端口的数据包</li></ul> <slide></slide> <h4 id="tcpdump-3"><a href="#tcpdump-3" class="header-anchor">#</a> tcpdump</h4> <p>理解输出：</p> <ul><li><a href="http://www.tcpdump.org/manpages/tcpdump.1.html#lbAG" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>具体的字段根据不同的报文类型会有所不同，一般格式如下：
<ul><li>第一字段是数据包被抓取时的本地时间戳</li> <li>第二个字段是网络层协议类型</li> <li>第三个字段是源 IP 地址和端口</li> <li>第四个字段是目标 IP 地址和端口</li> <li>第五个字段数据包参数</li></ul></li> <li>flags 字段通常取值如下：
<ul><li>[S] SYN 开始连接</li> <li>[.] ACK 成功接收或没有标记</li> <li>[P] PUSH 数据推送</li> <li>[F] FIN 结束连接</li> <li>[R] RST 重启连接</li> <li>[U] URG 紧急报文，优先处理</li> <li>[E] ECE 阻塞通知</li> <li>[W] CWR 阻塞窗口变小</li></ul></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.47d87362.js" defer></script><script src="/assets/js/2.68b28b64.js" defer></script><script src="/assets/js/41.5757b76e.js" defer></script>
  </body>
</html>
