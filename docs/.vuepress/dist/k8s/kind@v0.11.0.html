<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>kind@v0.11.0 | BLOGï¼ˆæ›´æ–°ä¸­...ï¼‰</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/assets/css/0.styles.bfaa3857.css" as="style"><link rel="preload" href="/assets/js/app.43768fea.js" as="script"><link rel="preload" href="/assets/js/2.d8080fc6.js" as="script"><link rel="preload" href="/assets/js/1.dbeab0c4.js" as="script"><link rel="preload" href="/assets/js/38.c44a0810.js" as="script"><link rel="prefetch" href="/assets/js/10.c56cb41a.js"><link rel="prefetch" href="/assets/js/11.9bf26a77.js"><link rel="prefetch" href="/assets/js/12.60aab09b.js"><link rel="prefetch" href="/assets/js/13.d4fb7f52.js"><link rel="prefetch" href="/assets/js/14.7d034093.js"><link rel="prefetch" href="/assets/js/15.1ea20ef1.js"><link rel="prefetch" href="/assets/js/16.a721e132.js"><link rel="prefetch" href="/assets/js/17.2426b936.js"><link rel="prefetch" href="/assets/js/18.d8f4ef3b.js"><link rel="prefetch" href="/assets/js/19.d637c81a.js"><link rel="prefetch" href="/assets/js/20.ed3ed5b8.js"><link rel="prefetch" href="/assets/js/21.a2e3b6ad.js"><link rel="prefetch" href="/assets/js/22.ae7cb6be.js"><link rel="prefetch" href="/assets/js/23.5ddbf8f2.js"><link rel="prefetch" href="/assets/js/24.410a7a68.js"><link rel="prefetch" href="/assets/js/25.8a31f158.js"><link rel="prefetch" href="/assets/js/26.fdc551b9.js"><link rel="prefetch" href="/assets/js/27.49390b71.js"><link rel="prefetch" href="/assets/js/28.4a289101.js"><link rel="prefetch" href="/assets/js/29.87772818.js"><link rel="prefetch" href="/assets/js/3.2d969418.js"><link rel="prefetch" href="/assets/js/30.78d54562.js"><link rel="prefetch" href="/assets/js/31.d2711f5f.js"><link rel="prefetch" href="/assets/js/32.bec6a19c.js"><link rel="prefetch" href="/assets/js/33.d53cf199.js"><link rel="prefetch" href="/assets/js/34.3bbd523f.js"><link rel="prefetch" href="/assets/js/35.2940164d.js"><link rel="prefetch" href="/assets/js/36.941a704d.js"><link rel="prefetch" href="/assets/js/37.dc83e17d.js"><link rel="prefetch" href="/assets/js/39.9615afa8.js"><link rel="prefetch" href="/assets/js/4.f8d5b16c.js"><link rel="prefetch" href="/assets/js/40.db557fe7.js"><link rel="prefetch" href="/assets/js/41.5b09c21d.js"><link rel="prefetch" href="/assets/js/42.065f376b.js"><link rel="prefetch" href="/assets/js/43.d7691861.js"><link rel="prefetch" href="/assets/js/44.09d10280.js"><link rel="prefetch" href="/assets/js/45.4dfac57a.js"><link rel="prefetch" href="/assets/js/46.b30d4d23.js"><link rel="prefetch" href="/assets/js/47.1b4ecc8a.js"><link rel="prefetch" href="/assets/js/48.0c585541.js"><link rel="prefetch" href="/assets/js/49.dadefe2d.js"><link rel="prefetch" href="/assets/js/5.e5bede36.js"><link rel="prefetch" href="/assets/js/50.8e629c27.js"><link rel="prefetch" href="/assets/js/51.6decb3da.js"><link rel="prefetch" href="/assets/js/52.e9f55fc1.js"><link rel="prefetch" href="/assets/js/53.72bdd3e1.js"><link rel="prefetch" href="/assets/js/54.963832ff.js"><link rel="prefetch" href="/assets/js/55.4a9a9dbe.js"><link rel="prefetch" href="/assets/js/56.bdcd1fc0.js"><link rel="prefetch" href="/assets/js/57.4a9cb216.js"><link rel="prefetch" href="/assets/js/58.26a742eb.js"><link rel="prefetch" href="/assets/js/59.6e8abcc9.js"><link rel="prefetch" href="/assets/js/6.2646630f.js"><link rel="prefetch" href="/assets/js/60.7ce94086.js"><link rel="prefetch" href="/assets/js/61.d25f9a69.js"><link rel="prefetch" href="/assets/js/62.8b9c66c4.js"><link rel="prefetch" href="/assets/js/63.78510717.js"><link rel="prefetch" href="/assets/js/64.b4c766e5.js"><link rel="prefetch" href="/assets/js/65.df6140e2.js"><link rel="prefetch" href="/assets/js/66.1546e903.js"><link rel="prefetch" href="/assets/js/67.4e2b81d6.js"><link rel="prefetch" href="/assets/js/68.6edca18c.js"><link rel="prefetch" href="/assets/js/69.10260310.js"><link rel="prefetch" href="/assets/js/7.62e8c4ff.js"><link rel="prefetch" href="/assets/js/70.18416266.js"><link rel="prefetch" href="/assets/js/71.15a18181.js"><link rel="prefetch" href="/assets/js/72.fdcc9a7e.js"><link rel="prefetch" href="/assets/js/73.f7265a26.js"><link rel="prefetch" href="/assets/js/74.a6ed4221.js"><link rel="prefetch" href="/assets/js/75.c2a8f099.js"><link rel="prefetch" href="/assets/js/76.4d06fa0c.js"><link rel="prefetch" href="/assets/js/77.82acf1e6.js"><link rel="prefetch" href="/assets/js/78.a71bba5b.js"><link rel="prefetch" href="/assets/js/79.002e5ca7.js"><link rel="prefetch" href="/assets/js/80.73b1461d.js"><link rel="prefetch" href="/assets/js/81.1abced8d.js"><link rel="prefetch" href="/assets/js/82.e212f1fb.js"><link rel="prefetch" href="/assets/js/83.123f86ed.js"><link rel="prefetch" href="/assets/js/84.9d0754d2.js"><link rel="prefetch" href="/assets/js/85.36b034ca.js"><link rel="prefetch" href="/assets/js/86.a2a3963d.js"><link rel="prefetch" href="/assets/js/87.9386657e.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.8c6c977a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bfaa3857.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">BLOGï¼ˆæ›´æ–°ä¸­...ï¼‰</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  ã€Homeã€‘
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  ã€Homeã€‘
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/profile.html" class="sidebar-link">è¯´æ˜</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ç³»ç»Ÿå¼€å‘ç¯å¢ƒ</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/git/git.html" class="sidebar-link">Git</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å¼€å‘å·¥å…·</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å‰ç«¯</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Golang</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>gRPC</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ•°æ®å­˜å‚¨</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ¶ˆæ¯é˜Ÿåˆ—</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>APIç½‘å…³</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ—¥å¿—é‡‡é›†</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Jenkins</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Gitlab</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>K8s</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/k8s/kubectl.html" class="sidebar-link">kubectl</a></li><li><a href="/k8s/kind@v0.11.0.html" aria-current="page" class="active sidebar-link">kind@v0.11.0</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s/kind@v0.11.0.html#å®˜ç½‘" class="sidebar-link">å®˜ç½‘</a></li><li class="sidebar-sub-header"><a href="/k8s/kind@v0.11.0.html#ä½¿ç”¨" class="sidebar-link">ä½¿ç”¨</a></li><li class="sidebar-sub-header"><a href="/k8s/kind@v0.11.0.html#æŸ¥çœ‹-pod" class="sidebar-link">æŸ¥çœ‹ pod</a></li><li class="sidebar-sub-header"><a href="/k8s/kind@v0.11.0.html#éƒ¨ç½²æœåŠ¡" class="sidebar-link">éƒ¨ç½²æœåŠ¡</a></li><li class="sidebar-sub-header"><a href="/k8s/kind@v0.11.0.html#è®¿é—®æœåŠ¡" class="sidebar-link">è®¿é—®æœåŠ¡</a></li><li class="sidebar-sub-header"><a href="/k8s/kind@v0.11.0.html#ä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨-metallb" class="sidebar-link">ä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨ MetalLB</a></li><li class="sidebar-sub-header"><a href="/k8s/kind@v0.11.0.html#ingress" class="sidebar-link">Ingress</a></li><li class="sidebar-sub-header"><a href="/k8s/kind@v0.11.0.html#è·¨å‘½åç©ºé—´çš„serviceè®¿é—®" class="sidebar-link">è·¨å‘½åç©ºé—´çš„serviceè®¿é—®</a></li><li class="sidebar-sub-header"><a href="/k8s/kind@v0.11.0.html#k8sä¸­ä½¿ç”¨apache-apisix" class="sidebar-link">k8sä¸­ä½¿ç”¨Apache-APISIX</a></li></ul></li><li><a href="/k8s/kind@v0.18.0.html" class="sidebar-link">kind@v0.18.0</a></li><li><a href="/k8s/minikube.html" class="sidebar-link">minikube</a></li><li><a href="/k8s/tencent.html" class="sidebar-link">è…¾è®¯äº‘</a></li><li><a href="/k8s/helm.html" class="sidebar-link">helm</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>é˜¿é‡Œäº‘</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/å¼€å‘å·¥å…·/å†…ç½‘ç©¿é€.html" class="sidebar-link">å†…ç½‘ç©¿é€</a></li><li><a href="/chatgpt/chatgpt.html" class="sidebar-link">ChatGPT</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="kind-v0-11-0"><a href="#kind-v0-11-0" class="header-anchor">#</a> kind@v0.11.0</h1> <h2 id="å®˜ç½‘"><a href="#å®˜ç½‘" class="header-anchor">#</a> å®˜ç½‘</h2> <p><a href="https://kind.sigs.k8s.io/" target="_blank" rel="noopener noreferrer">https://kind.sigs.k8s.io/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="header-anchor">#</a> ä½¿ç”¨</h2> <ul><li>å®‰è£…</li></ul> <div class="language- extra-class"><pre class="language-text"><code># é»˜è®¤ä¼šå®‰è£…åˆ° /home/user/go/bin ä¸­ ä¹Ÿå°±æ˜¯ GOPATH çš„ bin ä¸­
# è¿™é‡Œä½¿ç”¨ v0.11.0 ç‰ˆæœ¬çš„ kindï¼Œå¯¹åº”çš„ k8s ç‰ˆæœ¬æ˜¯ v1.21ï¼Œé€‰ç”¨è¿™ä¸ªç‰ˆæœ¬ä¸ºäº†ä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨ MetalLBï¼Œè¿‡é«˜çš„ç‰ˆæœ¬å°†ä¸èƒ½ä½¿ç”¨ã€‚
go install sigs.k8s.io/kind@v0.11.0
</code></pre></div><ul><li>åˆ›å»ºé›†ç¾¤</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>kind create cluster

<span class="token comment"># åˆ›å»ºç»“æœ</span>
Creating cluster <span class="token string">&quot;kind&quot;</span> <span class="token punctuation">..</span>.
 âœ“ Ensuring <span class="token function">node</span> image <span class="token punctuation">(</span>kindest/node:v1.21.1<span class="token punctuation">)</span> ğŸ–¼
 âœ“ Preparing nodes ğŸ“¦
 âœ“ Writing configuration ğŸ“œ
 âœ“ Starting control-plane ğŸ•¹ï¸
 âœ“ Installing CNI ğŸ”Œ
 âœ“ Installing StorageClass ğŸ’¾
Set kubectl context to <span class="token string">&quot;kind-kind&quot;</span>
You can now use your cluster with:

kubectl cluster-info <span class="token parameter variable">--context</span> kind-kind

Not sure what to <span class="token keyword">do</span> next? ğŸ˜…  Check out https://kind.sigs.k8s.io/docs/user/quick-start/
</code></pre></div><ul><li>åˆ é™¤é›†ç¾¤</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>kind delete cluster
</code></pre></div><ul><li>æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl cluster-info <span class="token parameter variable">--context</span> kind-kind
<span class="token comment"># æˆ–</span>
kubectl cluster-info

<span class="token comment">## æŸ¥çœ‹ç»“æœï¼Œå¯ä»¥çœ‹åˆ°æ˜¯è·‘åœ¨æœ¬åœ°</span>
kubectl cluster-info <span class="token parameter variable">--context</span> kind-kind
Kubernetes master is running at https://127.0.0.1:39107
KubeDNS is running at https://127.0.0.1:39107/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
</code></pre></div><p>è¿™é‡Œå®‰è£…çš„æ˜¯ 0.11.0 ç‰ˆæœ¬çš„ kindï¼Œæ‰€å¯¹åº”çš„ kubernetes ç‰ˆæœ¬æ˜¯ 1.21</p> <p>ç‰ˆæœ¬å¯¹åº”å…³ç³»ï¼š<a href="https://github.com/kubernetes-sigs/kind/releases?page=2" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes-sigs/kind/releases?page=2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>æœ¬åœ° kubeconfig</li></ul> <p>æŸ¥çœ‹ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code>kind get kubeconfig
</code></pre></div><p>kindï¼ˆKubernetes IN Dockerï¼‰æ˜¯ä¸€ç§åœ¨æœ¬åœ°ç¯å¢ƒä¸­è¿è¡Œ Kubernetes é›†ç¾¤çš„å·¥å…·ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œkind å°†é›†ç¾¤çš„ kubeconfig æ–‡ä»¶ä¿å­˜åœ¨ä»¥ä¸‹è·¯å¾„ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token environment constant">$HOME</span>/.kube/config
</code></pre></div><p>å¦‚æœä½ æƒ³åœ¨æ“ä½œ kind é›†ç¾¤æ—¶ä½¿ç”¨è‡ªå®šä¹‰çš„ kubeconfig æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® KUBECONFIG ç¯å¢ƒå˜é‡æ¥æŒ‡å®š kubeconfig æ–‡ä»¶çš„è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è®¾ç½®ç¯å¢ƒå˜é‡ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">KUBECONFIG</span><span class="token operator">=</span>/path/to/custom/kubeconfig
</code></pre></div><h2 id="æŸ¥çœ‹-pod"><a href="#æŸ¥çœ‹-pod" class="header-anchor">#</a> æŸ¥çœ‹ pod</h2> <ul><li>æŸ¥çœ‹ kind é»˜è®¤çš„ pod æ˜¯å¦éƒ½å¤„äº running çŠ¶æ€ã€‚</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl get pods <span class="token parameter variable">-A</span>
</code></pre></div><h2 id="éƒ¨ç½²æœåŠ¡"><a href="#éƒ¨ç½²æœåŠ¡" class="header-anchor">#</a> éƒ¨ç½²æœåŠ¡</h2> <p>å¦‚æœä½ çš„é•œåƒä»“åº“éœ€è¦ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œè®¿é—®ï¼Œä½ å¯ä»¥åœ¨ Kubernetes Pod çš„é…ç½®ä¸­ä½¿ç”¨ Secret å¯¹è±¡æ¥æŒ‡å®šå‡­æ®ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åœ¨ä½ æä¾›çš„ Pod é…ç½®ä¸­é›†æˆè¯¥å‡­æ®ï¼š</p> <ul><li>åˆ›å»ºä¸€ä¸ª Secret å¯¹è±¡ï¼š</li></ul> <p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªå«æœ‰ç”¨æˆ·åå’Œå¯†ç çš„ Secret å¯¹è±¡ã€‚ä½ å¯ä»¥ä½¿ç”¨ kubectl create secret docker-registry å‘½ä»¤æ¥åˆ›å»ºè¯¥ Secret å¯¹è±¡ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl create secret docker-registry my-registry-secret <span class="token punctuation">\</span>
  --docker-server<span class="token operator">=</span><span class="token operator">&lt;</span>registry-server<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
  --docker-username<span class="token operator">=</span><span class="token operator">&lt;</span>username<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
  --docker-password<span class="token operator">=</span><span class="token operator">&lt;</span>password<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
  --docker-email<span class="token operator">=</span><span class="token operator">&lt;</span>email<span class="token operator">&gt;</span>
</code></pre></div><ul><li>Deployment å’Œ Service é…ç½®</li></ul> <p>æ–°å»º apps.yaml</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment">#apiVersion: v1</span>
<span class="token comment">#kind: Pod</span>
<span class="token comment">#metadata:</span>
<span class="token comment">#  name: openapi-business</span>
<span class="token comment">#spec:</span>
<span class="token comment">#  # å®šä¹‰å®¹å™¨ï¼Œå¯ä»¥å¤šä¸ª</span>
<span class="token comment">#  containers:</span>
<span class="token comment">#    - name: openapi-business # å®¹å™¨åå­—</span>
<span class="token comment">#      image: registry.ap-southeast-1.aliyuncs.com/yhhnamespace/blogrpc-openapi-business:local # é•œåƒ</span>
<span class="token comment">#      # å¦‚æœä¿®æ”¹äº† imagePullPolicyï¼Œéœ€è¦åˆ é™¤ pod é‡æ–°åˆ›å»º</span>
<span class="token comment">#      imagePullPolicy: Always # Always: æ¯æ¬¡éƒ½é‡æ–°æ‹‰å–é•œåƒã€‚IfNotPresentï¼ˆé»˜è®¤å€¼ï¼‰ï¼šä»…å½“æœ¬åœ°æ²¡æœ‰è¯¥é•œåƒæ—¶æ‰ä¼šæ‹‰å–ã€‚Neverï¼šä»…ä½¿ç”¨æœ¬åœ°å·²æœ‰çš„é•œåƒï¼Œä¸ä¼šæ‹‰å–æ–°çš„é•œåƒã€‚</span>
<span class="token comment">#  imagePullSecrets:</span>
<span class="token comment">#    - name: my-registry-secret-1</span>

<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token comment"># éƒ¨ç½²åå­—</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> openapi<span class="token punctuation">-</span>business
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">4</span>
  <span class="token comment"># ç”¨æ¥æŸ¥æ‰¾å…³è”çš„ Podï¼Œæ‰€æœ‰æ ‡ç­¾éƒ½åŒ¹é…æ‰è¡Œ</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> openapi<span class="token punctuation">-</span>business
  <span class="token comment"># å®šä¹‰ Pod ç›¸å…³æ•°æ®</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> openapi<span class="token punctuation">-</span>business
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token comment"># å®šä¹‰å®¹å™¨ï¼Œå¯ä»¥å¤šä¸ª</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> openapi<span class="token punctuation">-</span>business <span class="token comment"># å®¹å™¨åå­—</span>
          <span class="token key atrule">image</span><span class="token punctuation">:</span> registry.ap<span class="token punctuation">-</span>southeast<span class="token punctuation">-</span>1.aliyuncs.com/yhhnamespace/blogrpc<span class="token punctuation">-</span>openapi<span class="token punctuation">-</span>business<span class="token punctuation">:</span>local <span class="token comment"># é•œåƒ</span>
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> Always
      <span class="token key atrule">imagePullSecrets</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>registry<span class="token punctuation">-</span>secret<span class="token punctuation">-</span><span class="token number">1</span>

<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> openapi<span class="token punctuation">-</span>business
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> openapi<span class="token punctuation">-</span>business
  <span class="token comment"># é»˜è®¤ ClusterIP é›†ç¾¤å†…å¯è®¿é—®ï¼ŒNodePort èŠ‚ç‚¹å¯è®¿é—®ï¼ŒLoadBalancer è´Ÿè½½å‡è¡¡æ¨¡å¼ï¼ˆéœ€è¦è´Ÿè½½å‡è¡¡å™¨æ‰å¯ç”¨ï¼‰</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9091</span>        <span class="token comment"># æœ¬ Service çš„ç«¯å£</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">9091</span>  <span class="token comment"># å®¹å™¨ç«¯å£</span>
      <span class="token key atrule">nodePort</span><span class="token punctuation">:</span> <span class="token number">31111</span>   <span class="token comment"># èŠ‚ç‚¹ç«¯å£ï¼ŒèŒƒå›´å›ºå®š 30000 ~ 32767</span>

<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token comment"># éƒ¨ç½²åå­—</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> blogrpc<span class="token punctuation">-</span>hello
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token comment"># ç”¨æ¥æŸ¥æ‰¾å…³è”çš„ Podï¼Œæ‰€æœ‰æ ‡ç­¾éƒ½åŒ¹é…æ‰è¡Œ</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> blogrpc<span class="token punctuation">-</span>hello
  <span class="token comment"># å®šä¹‰ Pod ç›¸å…³æ•°æ®</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> blogrpc<span class="token punctuation">-</span>hello
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token comment"># å®šä¹‰å®¹å™¨ï¼Œå¯ä»¥å¤šä¸ª</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> blogrpc<span class="token punctuation">-</span>hello <span class="token comment"># å®¹å™¨åå­—</span>
          <span class="token key atrule">image</span><span class="token punctuation">:</span> registry.ap<span class="token punctuation">-</span>southeast<span class="token punctuation">-</span>1.aliyuncs.com/yhhnamespace/blogrpc<span class="token punctuation">-</span>hello<span class="token punctuation">:</span>local <span class="token comment"># é•œåƒ</span>
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> Always
      <span class="token key atrule">imagePullSecrets</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>registry<span class="token punctuation">-</span>secret<span class="token punctuation">-</span><span class="token number">1</span>

<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> blogrpc<span class="token punctuation">-</span>hello
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> blogrpc<span class="token punctuation">-</span>hello
  <span class="token comment"># é»˜è®¤ ClusterIP é›†ç¾¤å†…å¯è®¿é—®ï¼ŒNodePort èŠ‚ç‚¹å¯è®¿é—®ï¼ŒLoadBalancer è´Ÿè½½å‡è¡¡æ¨¡å¼ï¼ˆéœ€è¦è´Ÿè½½å‡è¡¡å™¨æ‰å¯ç”¨ï¼‰</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">1701</span>        <span class="token comment"># æœ¬ Service çš„ç«¯å£</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">1701</span>  <span class="token comment"># å®¹å™¨ç«¯å£</span>
<span class="token comment">#      nodePort: 31000   # èŠ‚ç‚¹ç«¯å£ï¼ŒèŒƒå›´å›ºå®š 30000 ~ 32767</span>

<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token comment"># éƒ¨ç½²åå­—</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> blogrpc<span class="token punctuation">-</span>member
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token comment"># ç”¨æ¥æŸ¥æ‰¾å…³è”çš„ Podï¼Œæ‰€æœ‰æ ‡ç­¾éƒ½åŒ¹é…æ‰è¡Œ</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> blogrpc<span class="token punctuation">-</span>member
  <span class="token comment"># å®šä¹‰ Pod ç›¸å…³æ•°æ®</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> blogrpc<span class="token punctuation">-</span>member
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token comment"># å®šä¹‰å®¹å™¨ï¼Œå¯ä»¥å¤šä¸ª</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> blogrpc<span class="token punctuation">-</span>member <span class="token comment"># å®¹å™¨åå­—</span>
          <span class="token key atrule">image</span><span class="token punctuation">:</span> registry.ap<span class="token punctuation">-</span>southeast<span class="token punctuation">-</span>1.aliyuncs.com/yhhnamespace/blogrpc<span class="token punctuation">-</span>member<span class="token punctuation">:</span>local <span class="token comment"># é•œåƒ</span>
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> Always
          <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> MONGO_MASTER_DSN
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;mongodb://root:root@mongo-mongodb-0.mongo-mongodb-headless.default.svc.cluster.local,mongo-mongodb-1.mongo-mongodb-headless.default.svc.cluster.local/portal-master?authSource=admin&quot;</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> MONGO_MASTER_REPLSET
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;rs0&quot;</span>
      <span class="token key atrule">imagePullSecrets</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>registry<span class="token punctuation">-</span>secret<span class="token punctuation">-</span><span class="token number">1</span>

<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> blogrpc<span class="token punctuation">-</span>member
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> blogrpc<span class="token punctuation">-</span>member
  <span class="token comment"># é»˜è®¤ ClusterIP é›†ç¾¤å†…å¯è®¿é—®ï¼ŒNodePort èŠ‚ç‚¹å¯è®¿é—®ï¼ŒLoadBalancer è´Ÿè½½å‡è¡¡æ¨¡å¼ï¼ˆéœ€è¦è´Ÿè½½å‡è¡¡å™¨æ‰å¯ç”¨ï¼‰</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">1701</span>        <span class="token comment"># æœ¬ Service çš„ç«¯å£</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">1701</span>  <span class="token comment"># å®¹å™¨ç«¯å£</span>
<span class="token comment">#      nodePort: 31001   # èŠ‚ç‚¹ç«¯å£ï¼ŒèŒƒå›´å›ºå®š 30000 ~ 32767</span>
</code></pre></div><ul><li>éƒ¨ç½²</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl apply <span class="token parameter variable">-f</span> apps.yaml
</code></pre></div><h2 id="è®¿é—®æœåŠ¡"><a href="#è®¿é—®æœåŠ¡" class="header-anchor">#</a> è®¿é—®æœåŠ¡</h2> <h3 id="ç«¯å£è½¬å‘é›†ç¾¤å¤–è®¿é—®æœåŠ¡"><a href="#ç«¯å£è½¬å‘é›†ç¾¤å¤–è®¿é—®æœåŠ¡" class="header-anchor">#</a> ç«¯å£è½¬å‘é›†ç¾¤å¤–è®¿é—®æœåŠ¡</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl port-forward service/openapi-business <span class="token number">9091</span>:9091

<span class="token function">curl</span> localhost:9091/ping
<span class="token comment"># ç»“æœ</span>
<span class="token punctuation">{</span><span class="token string">&quot;hostname&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;openapi-business-6c89fb7b44-npt54&quot;</span>,<span class="token string">&quot;ip&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;10.244.0.5&quot;</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="èŠ‚ç‚¹å¤–è®¿é—®-openapi-business-æœåŠ¡ã€‚"><a href="#èŠ‚ç‚¹å¤–è®¿é—®-openapi-business-æœåŠ¡ã€‚" class="header-anchor">#</a> èŠ‚ç‚¹å¤–è®¿é—® openapi-business æœåŠ¡ã€‚</h3> <ul><li>æŸ¥çœ‹ kind èŠ‚ç‚¹çš„ ip</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> inspect kind-control-plane
</code></pre></div><ul><li>è®¿é—®</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">curl</span> <span class="token number">172.18</span>.0.2:31111/ping
<span class="token punctuation">{</span><span class="token string">&quot;hostname&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;openapi-business-56c695c975-m8ctl&quot;</span>,<span class="token string">&quot;ip&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;10.244.0.17&quot;</span><span class="token punctuation">}</span>
<span class="token function">curl</span> <span class="token number">172.18</span>.0.2:31111/ping
<span class="token punctuation">{</span><span class="token string">&quot;hostname&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;openapi-business-56c695c975-6zvxn&quot;</span>,<span class="token string">&quot;ip&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;10.244.0.23&quot;</span><span class="token punctuation">}</span>
<span class="token function">curl</span> <span class="token number">172.18</span>.0.2:31111/ping
<span class="token punctuation">{</span><span class="token string">&quot;hostname&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;openapi-business-56c695c975-jgpj2&quot;</span>,<span class="token string">&quot;ip&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;10.244.0.19&quot;</span><span class="token punctuation">}</span>
</code></pre></div><p>å¯ä»¥çœ‹åˆ°æ¯æ¬¡è®¿é—®è·å–çš„ hostname å’Œ ip ä¼šæ”¹å˜ï¼Œè¿™æ˜¯ç”±äº service çš„è´Ÿè½½å‡è¡¡</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>å¦‚æœé€šè¿‡æµè§ˆå™¨è®¿é—®çš„æ—¶å€™å‘ç°ä¸€ç›´è¿”å›çš„æ˜¯åŒä¸€ä¸ª hostname å’Œ ipï¼Œæ¸…é™¤æµè§ˆå™¨ç¼“å­˜å†å°è¯•ï¼Œå‘ç°æ¯æ¬¡æ¸…é™¤ç¼“å­˜ä¹‹åå†è¯·æ±‚ä¼šè¿”å›ä¸åŒçš„ hostname å’Œ ip è¯´æ˜è¯·æ±‚ä¹Ÿåˆ°è¾¾äº†ä¸åŒçš„ podã€‚ç–‘é—®ï¼šä¸ºå•¥ä¸æ¸…æ¥šç¼“å­˜æ¯æ¬¡åˆ°è¾¾çš„æ˜¯åŒä¸€ä¸ª pod?</p></div> <h3 id="èŠ‚ç‚¹ä¸Šè®¿é—®"><a href="#èŠ‚ç‚¹ä¸Šè®¿é—®" class="header-anchor">#</a> èŠ‚ç‚¹ä¸Šè®¿é—®</h3> <p>ç”±äºä½¿ç”¨çš„æ˜¯ Kind èµ·çš„ k8sï¼Œè¿™ä¸ª k8s æ˜¯è·‘åœ¨ docker ä¸­çš„ã€‚</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># è¿›å…¥å®¹å™¨</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> kind-control-plane <span class="token function">bash</span>
<span class="token comment"># è¿›å…¥ä¹‹åè®¿é—®</span>
root@kind-control-plane:/<span class="token comment"># curl localhost:31111/ping</span>
<span class="token comment"># å¤šæ¬¡è¯·æ±‚ç»“æœ</span>
<span class="token punctuation">{</span><span class="token string">&quot;hostname&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;openapi-business-56c695c975-2g6pr&quot;</span>,<span class="token string">&quot;ip&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;10.244.0.18&quot;</span><span class="token punctuation">}</span>
root@kind-control-plane:/<span class="token comment"># curl localhost:31111/ping</span>
<span class="token punctuation">{</span><span class="token string">&quot;hostname&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;openapi-business-56c695c975-6zvxn&quot;</span>,<span class="token string">&quot;ip&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;10.244.0.23&quot;</span><span class="token punctuation">}</span>
root@kind-control-plane:/<span class="token comment"># curl localhost:31111/ping</span>
<span class="token punctuation">{</span><span class="token string">&quot;hostname&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;openapi-business-56c695c975-6zvxn&quot;</span>,<span class="token string">&quot;ip&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;10.244.0.23&quot;</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="é›†ç¾¤å†…è®¿é—®"><a href="#é›†ç¾¤å†…è®¿é—®" class="header-anchor">#</a> é›†ç¾¤å†…è®¿é—®</h3> <ul><li>æŸ¥çœ‹æœ‰å“ªäº› pod</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl get pods
<span class="token comment"># ç»“æœ</span>
NAME                                READY   STATUS    RESTARTS   AGE
blogrpc-hello-67b7ff5b96-5sblb      <span class="token number">1</span>/1     Running   <span class="token number">0</span>          55m
blogrpc-hello-67b7ff5b96-m9wm5      <span class="token number">1</span>/1     Running   <span class="token number">0</span>          55m
blogrpc-member-74454ff4f6-2x74t     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          55m
blogrpc-member-74454ff4f6-7lwlc     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          55m
openapi-business-56c695c975-2g6pr   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          55m
openapi-business-56c695c975-6zvxn   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          55m
openapi-business-56c695c975-jgpj2   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          55m
openapi-business-56c695c975-m8ctl   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          55m
</code></pre></div><ul><li>æŸ¥çœ‹æœ‰å“ªäº› service</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl get <span class="token function">service</span>
<span class="token comment"># æŸ¥çœ‹ç»“æœ</span>
NAME               TYPE           CLUSTER-IP     EXTERNAL-IP    PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>          AGE
blogrpc-hello      ClusterIP      <span class="token number">10.96</span>.39.150   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>         <span class="token number">1701</span>/TCP         56m
blogrpc-member     ClusterIP      <span class="token number">10.96</span>.96.35    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>         <span class="token number">1701</span>/TCP         56m
kubernetes         ClusterIP      <span class="token number">10.96</span>.0.1      <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>         <span class="token number">443</span>/TCP          57m
openapi-business   NodePort       <span class="token number">10.96</span>.81.8     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>         <span class="token number">9091</span>:31111/TCP   56m
</code></pre></div><ul><li>è¿›å…¥å…¶ä¸­ä¸€ä¸ª pod</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> blogrpc-hello-67b7ff5b96-5sblb <span class="token function">bash</span>
<span class="token comment"># ç»“æœ</span>
kubectl <span class="token builtin class-name">exec</span> <span class="token punctuation">[</span>POD<span class="token punctuation">]</span> <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span> is DEPRECATED and will be removed <span class="token keyword">in</span> a future version. Use kubectl <span class="token builtin class-name">exec</span> <span class="token punctuation">[</span>POD<span class="token punctuation">]</span> -- <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span> instead.
root@blogrpc-hello-67b7ff5b96-5sblb:/app/hello<span class="token comment">#</span>
<span class="token comment"># å¯ä»¥æŸ¥çœ‹ hostname</span>
<span class="token function">cat</span> /etc/hostname
<span class="token comment"># ç»“æœä¸º</span>
blogrpc-hello-67b7ff5b96-5sblb
<span class="token comment"># é€šè¿‡ service name è®¿é—®</span>
<span class="token function">curl</span> openapi-business:9091/ping
<span class="token comment"># é€šè¿‡ service ip è®¿é—®</span>
<span class="token function">curl</span> <span class="token number">10.96</span>.81.8:9091/ping
</code></pre></div><p>ä¹Ÿå¯ä»¥æ­£å¸¸è®¿é—®ï¼Œå¤šæ¬¡è®¿é—®è¿”å›ä¸åŒçš„ hostnameã€‚</p> <h2 id="ä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨-metallb"><a href="#ä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨-metallb" class="header-anchor">#</a> ä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨ MetalLB</h2> <p>å‚è€ƒï¼š</p> <ul><li><p><a href="https://todoit.tech/k8s/metallb/" target="_blank" rel="noopener noreferrer">https://todoit.tech/k8s/metallb/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://developer.aliyun.com/article/1000971" target="_blank" rel="noopener noreferrer">https://developer.aliyun.com/article/1000971<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>å®‰è£…</p></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl apply <span class="token parameter variable">-f</span> https://raw.githubusercontent.com/metallb/metallb/v0.12.1/manifests/namespace.yaml
kubectl apply <span class="token parameter variable">-f</span> https://raw.githubusercontent.com/metallb/metallb/v0.12.1/manifests/metallb.yaml
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>å¦‚æœå­˜åœ¨ç½‘ç»œé—®é¢˜æ— æ³• apply å¯ä»¥è®¿é—®ä¸Šé¢çš„åœ°å€æŠŠå†…å®¹æ‹·è´ï¼Œå¯èƒ½éœ€è¦ç¿»å¢™ã€‚</p> <p>Kubernetes 1.6.x åˆ° Kubernetes 1.21.xï¼šPodSecurityPolicy æ˜¯ Kubernetes æ ¸å¿ƒçš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥åœ¨è¿™äº›ç‰ˆæœ¬ä¸­ä½¿ç”¨ã€‚</p> <p>Kubernetes 1.25 ç‰ˆæœ¬ä¹‹åï¼šKubernetes ç¤¾åŒºå®£å¸ƒ PodSecurityPolicy å°†è¢«å¼ƒç”¨ã€‚è‡ª Kubernetes 1.25 ç‰ˆæœ¬å¼€å§‹ï¼ŒPodSecurityPolicy åŠŸèƒ½è¢«ç§»é™¤ï¼Œå¹¶ä¸”ä¸å†æ¨èä½¿ç”¨ã€‚</p></div> <p>å†…å®¹å¦‚ä¸‹ï¼š</p> <ul><li>namespace.yaml</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Namespace
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> metallb<span class="token punctuation">-</span>system
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> metallb
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>kubectl apply <span class="token parameter variable">-f</span> namespace.yaml
</code></pre></div><ul><li>metallb.yaml</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> policy/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PodSecurityPolicy
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> metallb
  <span class="token key atrule">name</span><span class="token punctuation">:</span> controller
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">allowedCapabilities</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token key atrule">allowedHostPaths</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token key atrule">defaultAddCapabilities</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token key atrule">defaultAllowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">fsGroup</span><span class="token punctuation">:</span>
    <span class="token key atrule">ranges</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">max</span><span class="token punctuation">:</span> <span class="token number">65535</span>
      <span class="token key atrule">min</span><span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token key atrule">rule</span><span class="token punctuation">:</span> MustRunAs
  <span class="token key atrule">hostIPC</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">hostNetwork</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">hostPID</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">readOnlyRootFilesystem</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">requiredDropCapabilities</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> ALL
  <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span>
    <span class="token key atrule">ranges</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">max</span><span class="token punctuation">:</span> <span class="token number">65535</span>
      <span class="token key atrule">min</span><span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token key atrule">rule</span><span class="token punctuation">:</span> MustRunAs
  <span class="token key atrule">seLinux</span><span class="token punctuation">:</span>
    <span class="token key atrule">rule</span><span class="token punctuation">:</span> RunAsAny
  <span class="token key atrule">supplementalGroups</span><span class="token punctuation">:</span>
    <span class="token key atrule">ranges</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">max</span><span class="token punctuation">:</span> <span class="token number">65535</span>
      <span class="token key atrule">min</span><span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token key atrule">rule</span><span class="token punctuation">:</span> MustRunAs
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> configMap
  <span class="token punctuation">-</span> secret
  <span class="token punctuation">-</span> emptyDir
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> policy/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PodSecurityPolicy
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> metallb
  <span class="token key atrule">name</span><span class="token punctuation">:</span> speaker
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">allowedCapabilities</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> NET_RAW
  <span class="token key atrule">allowedHostPaths</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token key atrule">defaultAddCapabilities</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token key atrule">defaultAllowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">fsGroup</span><span class="token punctuation">:</span>
    <span class="token key atrule">rule</span><span class="token punctuation">:</span> RunAsAny
  <span class="token key atrule">hostIPC</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">hostNetwork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">hostPID</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">hostPorts</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">max</span><span class="token punctuation">:</span> <span class="token number">7472</span>
    <span class="token key atrule">min</span><span class="token punctuation">:</span> <span class="token number">7472</span>
  <span class="token punctuation">-</span> <span class="token key atrule">max</span><span class="token punctuation">:</span> <span class="token number">7946</span>
    <span class="token key atrule">min</span><span class="token punctuation">:</span> <span class="token number">7946</span>
  <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">readOnlyRootFilesystem</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">requiredDropCapabilities</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> ALL
  <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span>
    <span class="token key atrule">rule</span><span class="token punctuation">:</span> RunAsAny
  <span class="token key atrule">seLinux</span><span class="token punctuation">:</span>
    <span class="token key atrule">rule</span><span class="token punctuation">:</span> RunAsAny
  <span class="token key atrule">supplementalGroups</span><span class="token punctuation">:</span>
    <span class="token key atrule">rule</span><span class="token punctuation">:</span> RunAsAny
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> configMap
  <span class="token punctuation">-</span> secret
  <span class="token punctuation">-</span> emptyDir
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> metallb
  <span class="token key atrule">name</span><span class="token punctuation">:</span> controller
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> metallb<span class="token punctuation">-</span>system
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> metallb
  <span class="token key atrule">name</span><span class="token punctuation">:</span> speaker
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> metallb<span class="token punctuation">-</span>system
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> metallb
  <span class="token key atrule">name</span><span class="token punctuation">:</span> metallb<span class="token punctuation">-</span>system<span class="token punctuation">:</span>controller
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">''</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> services
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> get
  <span class="token punctuation">-</span> list
  <span class="token punctuation">-</span> watch
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">''</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> services/status
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> update
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">''</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> events
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> create
  <span class="token punctuation">-</span> patch
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> policy
  <span class="token key atrule">resourceNames</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> controller
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> podsecuritypolicies
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> use
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> metallb
  <span class="token key atrule">name</span><span class="token punctuation">:</span> metallb<span class="token punctuation">-</span>system<span class="token punctuation">:</span>speaker
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">''</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> services
  <span class="token punctuation">-</span> endpoints
  <span class="token punctuation">-</span> nodes
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> get
  <span class="token punctuation">-</span> list
  <span class="token punctuation">-</span> watch
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;discovery.k8s.io&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> endpointslices
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> get
  <span class="token punctuation">-</span> list
  <span class="token punctuation">-</span> watch
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">''</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> events
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> create
  <span class="token punctuation">-</span> patch
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> policy
  <span class="token key atrule">resourceNames</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> speaker
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> podsecuritypolicies
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> use
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> metallb
  <span class="token key atrule">name</span><span class="token punctuation">:</span> config<span class="token punctuation">-</span>watcher
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> metallb<span class="token punctuation">-</span>system
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">''</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> configmaps
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> get
  <span class="token punctuation">-</span> list
  <span class="token punctuation">-</span> watch
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> metallb
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pod<span class="token punctuation">-</span>lister
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> metallb<span class="token punctuation">-</span>system
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">''</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> pods
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> list
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> metallb
  <span class="token key atrule">name</span><span class="token punctuation">:</span> controller
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> metallb<span class="token punctuation">-</span>system
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">''</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> secrets
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> create
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">''</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> secrets
  <span class="token key atrule">resourceNames</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> memberlist
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> list
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> apps
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> deployments
  <span class="token key atrule">resourceNames</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> controller
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> get
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> metallb
  <span class="token key atrule">name</span><span class="token punctuation">:</span> metallb<span class="token punctuation">-</span>system<span class="token punctuation">:</span>controller
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
  <span class="token key atrule">name</span><span class="token punctuation">:</span> metallb<span class="token punctuation">-</span>system<span class="token punctuation">:</span>controller
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
  <span class="token key atrule">name</span><span class="token punctuation">:</span> controller
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> metallb<span class="token punctuation">-</span>system
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> metallb
  <span class="token key atrule">name</span><span class="token punctuation">:</span> metallb<span class="token punctuation">-</span>system<span class="token punctuation">:</span>speaker
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
  <span class="token key atrule">name</span><span class="token punctuation">:</span> metallb<span class="token punctuation">-</span>system<span class="token punctuation">:</span>speaker
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
  <span class="token key atrule">name</span><span class="token punctuation">:</span> speaker
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> metallb<span class="token punctuation">-</span>system
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> RoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> metallb
  <span class="token key atrule">name</span><span class="token punctuation">:</span> config<span class="token punctuation">-</span>watcher
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> metallb<span class="token punctuation">-</span>system
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
  <span class="token key atrule">name</span><span class="token punctuation">:</span> config<span class="token punctuation">-</span>watcher
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
  <span class="token key atrule">name</span><span class="token punctuation">:</span> controller
<span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
  <span class="token key atrule">name</span><span class="token punctuation">:</span> speaker
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> RoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> metallb
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pod<span class="token punctuation">-</span>lister
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> metallb<span class="token punctuation">-</span>system
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pod<span class="token punctuation">-</span>lister
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
  <span class="token key atrule">name</span><span class="token punctuation">:</span> speaker
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> RoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> metallb
  <span class="token key atrule">name</span><span class="token punctuation">:</span> controller
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> metallb<span class="token punctuation">-</span>system
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
  <span class="token key atrule">name</span><span class="token punctuation">:</span> controller
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
  <span class="token key atrule">name</span><span class="token punctuation">:</span> controller
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> DaemonSet
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> metallb
    <span class="token key atrule">component</span><span class="token punctuation">:</span> speaker
  <span class="token key atrule">name</span><span class="token punctuation">:</span> speaker
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> metallb<span class="token punctuation">-</span>system
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> metallb
      <span class="token key atrule">component</span><span class="token punctuation">:</span> speaker
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
        <span class="token key atrule">prometheus.io/port</span><span class="token punctuation">:</span> <span class="token string">'7472'</span>
        <span class="token key atrule">prometheus.io/scrape</span><span class="token punctuation">:</span> <span class="token string">'true'</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> metallb
        <span class="token key atrule">component</span><span class="token punctuation">:</span> speaker
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">args</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>port=7472
        <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>config=config
        <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>log<span class="token punctuation">-</span>level=info
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> METALLB_NODE_NAME
          <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
            <span class="token key atrule">fieldRef</span><span class="token punctuation">:</span>
              <span class="token key atrule">fieldPath</span><span class="token punctuation">:</span> spec.nodeName
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> METALLB_HOST
          <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
            <span class="token key atrule">fieldRef</span><span class="token punctuation">:</span>
              <span class="token key atrule">fieldPath</span><span class="token punctuation">:</span> status.hostIP
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> METALLB_ML_BIND_ADDR
          <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
            <span class="token key atrule">fieldRef</span><span class="token punctuation">:</span>
              <span class="token key atrule">fieldPath</span><span class="token punctuation">:</span> status.podIP
        <span class="token comment"># needed when another software is also using memberlist / port 7946</span>
        <span class="token comment"># when changing this default you also need to update the container ports definition</span>
        <span class="token comment"># and the PodSecurityPolicy hostPorts definition</span>
        <span class="token comment">#- name: METALLB_ML_BIND_PORT</span>
        <span class="token comment">#  value: &quot;7946&quot;</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> METALLB_ML_LABELS
          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;app=metallb,component=speaker&quot;</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> METALLB_ML_SECRET_KEY
          <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
            <span class="token key atrule">secretKeyRef</span><span class="token punctuation">:</span>
              <span class="token key atrule">name</span><span class="token punctuation">:</span> memberlist
              <span class="token key atrule">key</span><span class="token punctuation">:</span> secretkey
        <span class="token key atrule">image</span><span class="token punctuation">:</span> quay.io/metallb/speaker<span class="token punctuation">:</span>v0.12.1
        <span class="token key atrule">name</span><span class="token punctuation">:</span> speaker
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">7472</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> monitoring
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">7946</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> memberlist<span class="token punctuation">-</span>tcp
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">7946</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> memberlist<span class="token punctuation">-</span>udp
          <span class="token key atrule">protocol</span><span class="token punctuation">:</span> UDP
        <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
          <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
            <span class="token key atrule">path</span><span class="token punctuation">:</span> /metrics
            <span class="token key atrule">port</span><span class="token punctuation">:</span> monitoring
          <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
          <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
          <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">1</span>
          <span class="token key atrule">successThreshold</span><span class="token punctuation">:</span> <span class="token number">1</span>
          <span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token number">3</span>
        <span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span>
          <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
            <span class="token key atrule">path</span><span class="token punctuation">:</span> /metrics
            <span class="token key atrule">port</span><span class="token punctuation">:</span> monitoring
          <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
          <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
          <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">1</span>
          <span class="token key atrule">successThreshold</span><span class="token punctuation">:</span> <span class="token number">1</span>
          <span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token number">3</span>
        <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
          <span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
          <span class="token key atrule">capabilities</span><span class="token punctuation">:</span>
            <span class="token key atrule">add</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> NET_RAW
            <span class="token key atrule">drop</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> ALL
          <span class="token key atrule">readOnlyRootFilesystem</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">hostNetwork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
        <span class="token key atrule">kubernetes.io/os</span><span class="token punctuation">:</span> linux
      <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> speaker
      <span class="token key atrule">terminationGracePeriodSeconds</span><span class="token punctuation">:</span> <span class="token number">2</span>
      <span class="token key atrule">tolerations</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">effect</span><span class="token punctuation">:</span> NoSchedule
        <span class="token key atrule">key</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>role.kubernetes.io/master
        <span class="token key atrule">operator</span><span class="token punctuation">:</span> Exists
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> metallb
    <span class="token key atrule">component</span><span class="token punctuation">:</span> controller
  <span class="token key atrule">name</span><span class="token punctuation">:</span> controller
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> metallb<span class="token punctuation">-</span>system
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">revisionHistoryLimit</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> metallb
      <span class="token key atrule">component</span><span class="token punctuation">:</span> controller
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
        <span class="token key atrule">prometheus.io/port</span><span class="token punctuation">:</span> <span class="token string">'7472'</span>
        <span class="token key atrule">prometheus.io/scrape</span><span class="token punctuation">:</span> <span class="token string">'true'</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> metallb
        <span class="token key atrule">component</span><span class="token punctuation">:</span> controller
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">args</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>port=7472
        <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>config=config
        <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>log<span class="token punctuation">-</span>level=info
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> METALLB_ML_SECRET_NAME
          <span class="token key atrule">value</span><span class="token punctuation">:</span> memberlist
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> METALLB_DEPLOYMENT
          <span class="token key atrule">value</span><span class="token punctuation">:</span> controller
        <span class="token key atrule">image</span><span class="token punctuation">:</span> quay.io/metallb/controller<span class="token punctuation">:</span>v0.12.1
        <span class="token key atrule">name</span><span class="token punctuation">:</span> controller
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">7472</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> monitoring
        <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
          <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
            <span class="token key atrule">path</span><span class="token punctuation">:</span> /metrics
            <span class="token key atrule">port</span><span class="token punctuation">:</span> monitoring
          <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
          <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
          <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">1</span>
          <span class="token key atrule">successThreshold</span><span class="token punctuation">:</span> <span class="token number">1</span>
          <span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token number">3</span>
        <span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span>
          <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
            <span class="token key atrule">path</span><span class="token punctuation">:</span> /metrics
            <span class="token key atrule">port</span><span class="token punctuation">:</span> monitoring
          <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
          <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
          <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">1</span>
          <span class="token key atrule">successThreshold</span><span class="token punctuation">:</span> <span class="token number">1</span>
          <span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token number">3</span>
        <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
          <span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
          <span class="token key atrule">capabilities</span><span class="token punctuation">:</span>
            <span class="token key atrule">drop</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> all
          <span class="token key atrule">readOnlyRootFilesystem</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
        <span class="token key atrule">kubernetes.io/os</span><span class="token punctuation">:</span> linux
      <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
        <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">65534</span>
        <span class="token key atrule">fsGroup</span><span class="token punctuation">:</span> <span class="token number">65534</span>
      <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> controller
      <span class="token key atrule">terminationGracePeriodSeconds</span><span class="token punctuation">:</span> <span class="token number">0</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>kubectl apply <span class="token parameter variable">-f</span> metallb.yaml
</code></pre></div><ul><li>æŸ¥çœ‹ metallb-system</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl get pods <span class="token parameter variable">-n</span> metallb-system
<span class="token comment"># ç»“æœ</span>
NAME                          READY   STATUS    RESTARTS   AGE
controller-66445f859d-rlb5z   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          96m
speaker-4c8cd                 <span class="token number">1</span>/1     Running   <span class="token number">0</span>          96m
</code></pre></div><ul><li>æŠŠ apps.yaml ä¸­çš„ openapi-business çš„ Service type æ”¹æˆ <code>LoadBalancer</code></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl apply <span class="token parameter variable">-f</span> apps.yaml
</code></pre></div><ul><li>æŸ¥çœ‹ service</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl get svc
NAME               TYPE           CLUSTER-IP     EXTERNAL-IP    PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>          AGE
blogrpc-hello      ClusterIP      <span class="token number">10.96</span>.39.150   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>         <span class="token number">1701</span>/TCP         96m
blogrpc-member     ClusterIP      <span class="token number">10.96</span>.96.35    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>         <span class="token number">1701</span>/TCP         96m
kubernetes         ClusterIP      <span class="token number">10.96</span>.0.1      <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>         <span class="token number">443</span>/TCP          96m
openapi-business   LoadBalancer   <span class="token number">10.96</span>.81.8     <span class="token operator">&lt;</span>pending<span class="token operator">&gt;</span>      <span class="token number">9091</span>:31111/TCP   96m
</code></pre></div><p>æ­¤æ—¶å†æ£€æŸ¥ LoadBalancer Service çš„çŠ¶æ€ä»ç„¶æ˜¯ Pending çš„ï¼Œå—¯ï¼Ÿå› ä¸ºï¼ŒMetalLB è¦ä¸º Service åˆ†é… IP åœ°å€ï¼Œä½† IP åœ°å€ä¸æ˜¯å‡­ç©ºæ¥çš„ï¼Œè€Œæ˜¯éœ€è¦é¢„å…ˆæä¾›ä¸€ä¸ªåœ°å€åº“ã€‚</p> <ul><li>ä½¿ç”¨ Layer 2 æ¨¡å¼ï¼Œé€šè¿‡ ConfigMap ä¸ºå…¶æä¾›ä¸€ä¸ª IP æ®µï¼š</li></ul> <p>config.yaml</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> metallb<span class="token punctuation">-</span>system
  <span class="token key atrule">name</span><span class="token punctuation">:</span> config
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    address-pools:
    - name: default
      protocol: layer2
      addresses:
        - 192.168.1.30-192.168.1.49</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>kubectl apply <span class="token parameter variable">-f</span> config.yaml
</code></pre></div><ul><li>æ­¤æ—¶å†æŸ¥çœ‹ serviceï¼Œå¯ä»¥çœ‹åˆ° MetalLB ä¸º Service openapi-business åˆ†é…äº†åœ°å€ 192.168.1.30</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl get svc
<span class="token comment"># ç»“æœ</span>
NAME               TYPE           CLUSTER-IP     EXTERNAL-IP    PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>          AGE
blogrpc-hello      ClusterIP      <span class="token number">10.96</span>.39.150   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>         <span class="token number">1701</span>/TCP         96m
blogrpc-member     ClusterIP      <span class="token number">10.96</span>.96.35    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>         <span class="token number">1701</span>/TCP         96m
kubernetes         ClusterIP      <span class="token number">10.96</span>.0.1      <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>         <span class="token number">443</span>/TCP          96m
openapi-business   LoadBalancer   <span class="token number">10.96</span>.81.8     <span class="token number">192.168</span>.1.30   <span class="token number">9091</span>:31111/TCP   96m
</code></pre></div><ul><li>åˆ°èŠ‚ç‚¹ä¸Šè®¿é—®</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> kind-control-plane <span class="token function">bash</span>
<span class="token comment"># ä½¿ç”¨ CLUSTER-IP</span>
root@kind-control-plane:/<span class="token comment"># curl 10.96.81.8:9091/ping</span>
<span class="token punctuation">{</span><span class="token string">&quot;hostname&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;openapi-business-56c695c975-jgpj2&quot;</span>,<span class="token string">&quot;ip&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;10.244.0.19&quot;</span><span class="token punctuation">}</span>
root@kind-control-plane:/<span class="token comment"># curl 10.96.81.8:9091/ping</span>
<span class="token punctuation">{</span><span class="token string">&quot;hostname&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;openapi-business-56c695c975-2g6pr&quot;</span>,<span class="token string">&quot;ip&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;10.244.0.18&quot;</span><span class="token punctuation">}</span>
<span class="token comment"># ä½¿ç”¨ EXTERNAL-IP ï¼ˆMetalLB åˆ†é…çš„ ipï¼‰</span>
root@kind-control-plane:/<span class="token comment"># curl 192.168.1.30:9091/ping</span>
<span class="token punctuation">{</span><span class="token string">&quot;hostname&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;openapi-business-56c695c975-m8ctl&quot;</span>,<span class="token string">&quot;ip&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;10.244.0.17&quot;</span><span class="token punctuation">}</span>
root@kind-control-plane:/<span class="token comment"># curl 192.168.1.30:9091/ping</span>
<span class="token punctuation">{</span><span class="token string">&quot;hostname&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;openapi-business-56c695c975-6zvxn&quot;</span>,<span class="token string">&quot;ip&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;10.244.0.23&quot;</span><span class="token punctuation">}</span>
</code></pre></div><h2 id="ingress"><a href="#ingress" class="header-anchor">#</a> Ingress</h2> <ul><li>ä½¿ç”¨ kind åˆ›å»ºé›†ç¾¤</li></ul> <p><a href="https://kind.sigs.k8s.io/docs/user/ingress/#create-cluster" target="_blank" rel="noopener noreferrer">https://kind.sigs.k8s.io/docs/user/ingress/#create-cluster<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>å‚è€ƒï¼š <a href="https://blog.csdn.net/cn_lyg/article/details/132577367" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/cn_lyg/article/details/132577367<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>æ‰§è¡Œï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">|</span> kind create cluster <span class="token parameter variable">--config</span><span class="token operator">=</span>-</span>
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  kubeadmConfigPatches:
  - |
    kind: InitConfiguration
    nodeRegistration:
      kubeletExtraArgs:
        node-labels: &quot;ingress-ready=true&quot;
  extraPortMappings:
  - containerPort: 80
    hostPort: 8888
    protocol: TCP
  - containerPort: 443
    hostPort: 443
    protocol: TCP
EOF</span>
</code></pre></div><ul><li>æŸ¥çœ‹ k8s ç‰ˆæœ¬</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl version <span class="token parameter variable">--short</span>
<span class="token comment"># æŸ¥çœ‹ç»“æœ</span>
Client Version: v1.23.0
Server Version: v1.21.1
WARNING: version difference between client <span class="token punctuation">(</span><span class="token number">1.23</span><span class="token punctuation">)</span> and server <span class="token punctuation">(</span><span class="token number">1.21</span><span class="token punctuation">)</span> exceeds the supported minor version skew of +/-1
</code></pre></div><ul><li>æŸ¥çœ‹ ingress-controller å’Œ k8s ç‰ˆæœ¬å¯¹åº”å…³ç³»</li></ul> <p><a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes/ingress-nginx<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>å…³ç³»å¦‚ä¸‹ï¼š
<img src="/assets/img/image-1.015d6c44.png" alt=""></p> <p>æ‰€ä»¥è¿™é‡Œä½¿ç”¨ v1.3.1 ç‰ˆæœ¬</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># è‹¥è®¿é—®ä¸äº†åˆ™ç¿»å¢™ä¸‹è½½æˆ–è®¿é—®è¯¥è¿æ¥ cory å†…å®¹åˆ°æœ¬åœ°æ–‡ä»¶</span>
kubectl apply <span class="token parameter variable">-f</span> https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.3.1/deploy/static/provider/kind/deploy.yaml
</code></pre></div><p>å†…å®¹å¦‚ä¸‹ï¼š</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Namespace
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">automountServiceAccountToken</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> controller
    <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 1.3.1
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> admission<span class="token punctuation">-</span>webhook
    <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 1.3.1
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>admission
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> controller
    <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 1.3.1
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> namespaces
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> get
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> configmaps
      <span class="token punctuation">-</span> pods
      <span class="token punctuation">-</span> secrets
      <span class="token punctuation">-</span> endpoints
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> get
      <span class="token punctuation">-</span> list
      <span class="token punctuation">-</span> watch
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> services
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> get
      <span class="token punctuation">-</span> list
      <span class="token punctuation">-</span> watch
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> networking.k8s.io
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ingresses
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> get
      <span class="token punctuation">-</span> list
      <span class="token punctuation">-</span> watch
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> networking.k8s.io
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ingresses/status
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> update
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> networking.k8s.io
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ingressclasses
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> get
      <span class="token punctuation">-</span> list
      <span class="token punctuation">-</span> watch
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>
    <span class="token key atrule">resourceNames</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ingress<span class="token punctuation">-</span>controller<span class="token punctuation">-</span>leader
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> configmaps
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> get
      <span class="token punctuation">-</span> update
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> configmaps
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> create
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> coordination.k8s.io
    <span class="token key atrule">resourceNames</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ingress<span class="token punctuation">-</span>controller<span class="token punctuation">-</span>leader
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> leases
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> get
      <span class="token punctuation">-</span> update
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> coordination.k8s.io
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> leases
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> create
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> events
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> create
      <span class="token punctuation">-</span> patch
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> admission<span class="token punctuation">-</span>webhook
    <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 1.3.1
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>admission
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> secrets
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> get
      <span class="token punctuation">-</span> create
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 1.3.1
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> configmaps
      <span class="token punctuation">-</span> endpoints
      <span class="token punctuation">-</span> nodes
      <span class="token punctuation">-</span> pods
      <span class="token punctuation">-</span> secrets
      <span class="token punctuation">-</span> namespaces
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> list
      <span class="token punctuation">-</span> watch
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> coordination.k8s.io
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> leases
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> list
      <span class="token punctuation">-</span> watch
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> nodes
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> get
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> services
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> get
      <span class="token punctuation">-</span> list
      <span class="token punctuation">-</span> watch
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> networking.k8s.io
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ingresses
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> get
      <span class="token punctuation">-</span> list
      <span class="token punctuation">-</span> watch
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> events
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> create
      <span class="token punctuation">-</span> patch
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> networking.k8s.io
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ingresses/status
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> update
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> networking.k8s.io
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ingressclasses
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> get
      <span class="token punctuation">-</span> list
      <span class="token punctuation">-</span> watch
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> admission<span class="token punctuation">-</span>webhook
    <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 1.3.1
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>admission
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> admissionregistration.k8s.io
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> validatingwebhookconfigurations
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> get
      <span class="token punctuation">-</span> update
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> RoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> controller
    <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 1.3.1
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
    <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> RoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> admission<span class="token punctuation">-</span>webhook
    <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 1.3.1
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>admission
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>admission
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
    <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>admission
    <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 1.3.1
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
    <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> admission<span class="token punctuation">-</span>webhook
    <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 1.3.1
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>admission
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>admission
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
    <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>admission
    <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">allow-snippet-annotations</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> controller
    <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 1.3.1
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>controller
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> controller
    <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 1.3.1
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>controller
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ipFamilies</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> IPv4
  <span class="token key atrule">ipFamilyPolicy</span><span class="token punctuation">:</span> SingleStack
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">appProtocol</span><span class="token punctuation">:</span> http
      <span class="token key atrule">name</span><span class="token punctuation">:</span> http
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> http
    <span class="token punctuation">-</span> <span class="token key atrule">appProtocol</span><span class="token punctuation">:</span> https
      <span class="token key atrule">name</span><span class="token punctuation">:</span> https
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">443</span>
      <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> https
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> controller
    <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> controller
    <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 1.3.1
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>controller<span class="token punctuation">-</span>admission
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">appProtocol</span><span class="token punctuation">:</span> https
      <span class="token key atrule">name</span><span class="token punctuation">:</span> https<span class="token punctuation">-</span>webhook
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">443</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> webhook
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> controller
    <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> controller
    <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 1.3.1
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>controller
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">minReadySeconds</span><span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token key atrule">revisionHistoryLimit</span><span class="token punctuation">:</span> <span class="token number">10</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> controller
      <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
      <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
  <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">rollingUpdate</span><span class="token punctuation">:</span>
      <span class="token key atrule">maxUnavailable</span><span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> RollingUpdate
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> controller
        <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
        <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> /nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>controller
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>election<span class="token punctuation">-</span>id=ingress<span class="token punctuation">-</span>controller<span class="token punctuation">-</span>leader
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>controller<span class="token punctuation">-</span>class=k8s.io/ingress<span class="token punctuation">-</span>nginx
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>class=nginx
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>configmap=$(POD_NAMESPACE)/ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>controller
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>validating<span class="token punctuation">-</span>webhook=<span class="token punctuation">:</span><span class="token number">8443</span>
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>validating<span class="token punctuation">-</span>webhook<span class="token punctuation">-</span>certificate=/usr/local/certificates/cert
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>validating<span class="token punctuation">-</span>webhook<span class="token punctuation">-</span>key=/usr/local/certificates/key
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>watch<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>without<span class="token punctuation">-</span>class=true
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>publish<span class="token punctuation">-</span>status<span class="token punctuation">-</span>address=localhost
          <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> POD_NAME
              <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
                <span class="token key atrule">fieldRef</span><span class="token punctuation">:</span>
                  <span class="token key atrule">fieldPath</span><span class="token punctuation">:</span> metadata.name
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> POD_NAMESPACE
              <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
                <span class="token key atrule">fieldRef</span><span class="token punctuation">:</span>
                  <span class="token key atrule">fieldPath</span><span class="token punctuation">:</span> metadata.namespace
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> LD_PRELOAD
              <span class="token key atrule">value</span><span class="token punctuation">:</span> /usr/local/lib/libmimalloc.so
<span class="token comment">#          image: registry.k8s.io/ingress-nginx/controller:v1.3.1@sha256:54f7fe2c6c5a9db9a0ebf1131797109bb7a4d91f56b9b362bde2abd237dd1974</span>
          <span class="token key atrule">image</span><span class="token punctuation">:</span> registry.cn<span class="token punctuation">-</span>hangzhou.aliyuncs.com/google_containers/nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>controller<span class="token punctuation">:</span>v1.3.1
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
          <span class="token key atrule">lifecycle</span><span class="token punctuation">:</span>
            <span class="token key atrule">preStop</span><span class="token punctuation">:</span>
              <span class="token key atrule">exec</span><span class="token punctuation">:</span>
                <span class="token key atrule">command</span><span class="token punctuation">:</span>
                  <span class="token punctuation">-</span> /wait<span class="token punctuation">-</span>shutdown
          <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
            <span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token number">5</span>
            <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
              <span class="token key atrule">path</span><span class="token punctuation">:</span> /healthz
              <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">10254</span>
              <span class="token key atrule">scheme</span><span class="token punctuation">:</span> HTTP
            <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
            <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
            <span class="token key atrule">successThreshold</span><span class="token punctuation">:</span> <span class="token number">1</span>
            <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">1</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> controller
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
              <span class="token key atrule">hostPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
              <span class="token key atrule">name</span><span class="token punctuation">:</span> http
              <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">443</span>
              <span class="token key atrule">hostPort</span><span class="token punctuation">:</span> <span class="token number">443</span>
              <span class="token key atrule">name</span><span class="token punctuation">:</span> https
              <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8443</span>
              <span class="token key atrule">name</span><span class="token punctuation">:</span> webhook
              <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
          <span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span>
            <span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token number">3</span>
            <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
              <span class="token key atrule">path</span><span class="token punctuation">:</span> /healthz
              <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">10254</span>
              <span class="token key atrule">scheme</span><span class="token punctuation">:</span> HTTP
            <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
            <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
            <span class="token key atrule">successThreshold</span><span class="token punctuation">:</span> <span class="token number">1</span>
            <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">1</span>
          <span class="token key atrule">resources</span><span class="token punctuation">:</span>
            <span class="token key atrule">requests</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 100m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 90Mi
          <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
            <span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">capabilities</span><span class="token punctuation">:</span>
              <span class="token key atrule">add</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> NET_BIND_SERVICE
              <span class="token key atrule">drop</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> ALL
            <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">101</span>
          <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /usr/local/certificates/
              <span class="token key atrule">name</span><span class="token punctuation">:</span> webhook<span class="token punctuation">-</span>cert
              <span class="token key atrule">readOnly</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">dnsPolicy</span><span class="token punctuation">:</span> ClusterFirst
      <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
        <span class="token key atrule">ingress-ready</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
        <span class="token key atrule">kubernetes.io/os</span><span class="token punctuation">:</span> linux
      <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
      <span class="token key atrule">terminationGracePeriodSeconds</span><span class="token punctuation">:</span> <span class="token number">0</span>
      <span class="token key atrule">tolerations</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">effect</span><span class="token punctuation">:</span> NoSchedule
          <span class="token key atrule">key</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>role.kubernetes.io/master
          <span class="token key atrule">operator</span><span class="token punctuation">:</span> Equal
        <span class="token punctuation">-</span> <span class="token key atrule">effect</span><span class="token punctuation">:</span> NoSchedule
          <span class="token key atrule">key</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>role.kubernetes.io/control<span class="token punctuation">-</span>plane
          <span class="token key atrule">operator</span><span class="token punctuation">:</span> Equal
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> webhook<span class="token punctuation">-</span>cert
          <span class="token key atrule">secret</span><span class="token punctuation">:</span>
            <span class="token key atrule">secretName</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>admission
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> batch/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Job
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> admission<span class="token punctuation">-</span>webhook
    <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 1.3.1
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>admission<span class="token punctuation">-</span>create
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> admission<span class="token punctuation">-</span>webhook
        <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
        <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
        <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
        <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 1.3.1
      <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>admission<span class="token punctuation">-</span>create
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> create
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>host=ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>controller<span class="token punctuation">-</span>admission<span class="token punctuation">,</span>ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>controller<span class="token punctuation">-</span>admission.$(POD_NAMESPACE).svc
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>namespace=$(POD_NAMESPACE)
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>secret<span class="token punctuation">-</span>name=ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>admission
          <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> POD_NAMESPACE
              <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
                <span class="token key atrule">fieldRef</span><span class="token punctuation">:</span>
                  <span class="token key atrule">fieldPath</span><span class="token punctuation">:</span> metadata.namespace
<span class="token comment">#          image: registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.3.0@sha256:549e71a6ca248c5abd51cdb73dbc3083df62cf92ed5e6147c780e30f7e007a47</span>
          <span class="token key atrule">image</span><span class="token punctuation">:</span> registry.cn<span class="token punctuation">-</span>hangzhou.aliyuncs.com/google_containers/kube<span class="token punctuation">-</span>webhook<span class="token punctuation">-</span>certgen<span class="token punctuation">:</span>v1.3.0
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
          <span class="token key atrule">name</span><span class="token punctuation">:</span> create
          <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
            <span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
        <span class="token key atrule">kubernetes.io/os</span><span class="token punctuation">:</span> linux
      <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> OnFailure
      <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
        <span class="token key atrule">fsGroup</span><span class="token punctuation">:</span> <span class="token number">2000</span>
        <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">2000</span>
      <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>admission
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> batch/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Job
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> admission<span class="token punctuation">-</span>webhook
    <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 1.3.1
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>admission<span class="token punctuation">-</span>patch
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> admission<span class="token punctuation">-</span>webhook
        <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
        <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
        <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
        <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 1.3.1
      <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>admission<span class="token punctuation">-</span>patch
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> patch
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>webhook<span class="token punctuation">-</span>name=ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>admission
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>namespace=$(POD_NAMESPACE)
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>patch<span class="token punctuation">-</span>mutating=false
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>secret<span class="token punctuation">-</span>name=ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>admission
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>patch<span class="token punctuation">-</span>failure<span class="token punctuation">-</span>policy=Fail
          <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> POD_NAMESPACE
              <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
                <span class="token key atrule">fieldRef</span><span class="token punctuation">:</span>
                  <span class="token key atrule">fieldPath</span><span class="token punctuation">:</span> metadata.namespace
<span class="token comment">#          image: registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.3.0@sha256:549e71a6ca248c5abd51cdb73dbc3083df62cf92ed5e6147c780e30f7e007a47</span>
          <span class="token key atrule">image</span><span class="token punctuation">:</span> registry.cn<span class="token punctuation">-</span>hangzhou.aliyuncs.com/google_containers/kube<span class="token punctuation">-</span>webhook<span class="token punctuation">-</span>certgen<span class="token punctuation">:</span>v1.3.0
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
          <span class="token key atrule">name</span><span class="token punctuation">:</span> patch
          <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
            <span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
        <span class="token key atrule">kubernetes.io/os</span><span class="token punctuation">:</span> linux
      <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> OnFailure
      <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
        <span class="token key atrule">fsGroup</span><span class="token punctuation">:</span> <span class="token number">2000</span>
        <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">2000</span>
      <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>admission
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> IngressClass
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> controller
    <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 1.3.1
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">controller</span><span class="token punctuation">:</span> k8s.io/ingress<span class="token punctuation">-</span>nginx
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> admissionregistration.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ValidatingWebhookConfiguration
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> admission<span class="token punctuation">-</span>webhook
    <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 1.3.1
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>admission
<span class="token key atrule">webhooks</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">admissionReviewVersions</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> v1
    <span class="token key atrule">clientConfig</span><span class="token punctuation">:</span>
      <span class="token key atrule">service</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>controller<span class="token punctuation">-</span>admission
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
        <span class="token key atrule">path</span><span class="token punctuation">:</span> /networking/v1/ingresses
    <span class="token key atrule">failurePolicy</span><span class="token punctuation">:</span> Fail
    <span class="token key atrule">matchPolicy</span><span class="token punctuation">:</span> Equivalent
    <span class="token key atrule">name</span><span class="token punctuation">:</span> validate.nginx.ingress.kubernetes.io
    <span class="token key atrule">rules</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> networking.k8s.io
        <span class="token key atrule">apiVersions</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> v1
        <span class="token key atrule">operations</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> CREATE
          <span class="token punctuation">-</span> UPDATE
        <span class="token key atrule">resources</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> ingresses
    <span class="token key atrule">sideEffects</span><span class="token punctuation">:</span> None
</code></pre></div><p>æ‰§è¡Œ <code>kubectl apply -f deploy.yaml</code> åæŸ¥çœ‹ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl get pods <span class="token parameter variable">-n</span> ingress-nginx
<span class="token comment"># æŸ¥çœ‹ç»“æœ</span>
NAME                                        READY   STATUS      RESTARTS   AGE
ingress-nginx-admission-create-4pnvm        <span class="token number">0</span>/1     Completed   <span class="token number">0</span>          62m
ingress-nginx-admission-patch-2bbdd         <span class="token number">0</span>/1     Completed   <span class="token number">1</span>          62m
ingress-nginx-controller-8646749749-t68gw   <span class="token number">1</span>/1     Running     <span class="token number">0</span>          62m
</code></pre></div><ul><li>æµ‹è¯• ingress</li></ul> <p>åˆ›å»º ingress-test.yaml æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> foo<span class="token punctuation">-</span>app
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> foo
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">command</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> /agnhost
        <span class="token punctuation">-</span> netexec
        <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>http<span class="token punctuation">-</span>port
        <span class="token punctuation">-</span> <span class="token string">&quot;8080&quot;</span>
      <span class="token key atrule">image</span><span class="token punctuation">:</span>  e2eteam/agnhost<span class="token punctuation">:</span><span class="token number">2.2</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> foo<span class="token punctuation">-</span>app
<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> foo<span class="token punctuation">-</span>service
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> foo
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token comment"># Default port used by the image</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> example<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span><span class="token number">2</span>
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
    <span class="token key atrule">nginx.ingress.kubernetes.io/rewrite-target</span><span class="token punctuation">:</span> /$2
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">http</span><span class="token punctuation">:</span>
        <span class="token key atrule">paths</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">pathType</span><span class="token punctuation">:</span> Prefix
            <span class="token key atrule">path</span><span class="token punctuation">:</span> /foo(/<span class="token punctuation">|</span>$)(.<span class="token important">*)</span>
            <span class="token key atrule">backend</span><span class="token punctuation">:</span>
              <span class="token key atrule">service</span><span class="token punctuation">:</span>
                <span class="token key atrule">name</span><span class="token punctuation">:</span> foo<span class="token punctuation">-</span>service
                <span class="token key atrule">port</span><span class="token punctuation">:</span>
                  <span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">8080</span>
<span class="token punctuation">---</span>
</code></pre></div><p>æ‰§è¡Œï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl apply <span class="token parameter variable">-f</span> ingress-test.yaml
</code></pre></div><p>æŸ¥çœ‹ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl get pods
<span class="token comment"># æŸ¥çœ‹ç»“æœ</span>
NAME                                READY   STATUS    RESTARTS   AGE
foo-app                             <span class="token number">1</span>/1     Running   <span class="token number">0</span>          56m
</code></pre></div><p>æµ‹è¯•ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">curl</span> http://localhost:8888/foo/hostname
<span class="token comment"># ç»“æœ</span>
foo-app
</code></pre></div><h2 id="è·¨å‘½åç©ºé—´çš„serviceè®¿é—®"><a href="#è·¨å‘½åç©ºé—´çš„serviceè®¿é—®" class="header-anchor">#</a> è·¨å‘½åç©ºé—´çš„serviceè®¿é—®</h2> <p>åœ¨ Kubernetes ä¸­ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥åœ¨ä¸€ä¸ªå‘½åç©ºé—´çš„ Pod ä¸­é€šè¿‡ <code>service-name.namespace</code> çš„å½¢å¼æ¥è®¿é—®å¦ä¸€ä¸ªå‘½åç©ºé—´çš„ Serviceï¼Œè€Œä¸éœ€è¦æ˜¾å¼åœ°åŠ ä¸Š .svc.cluster.localã€‚è¿™æ˜¯å› ä¸º Kubernetes é»˜è®¤æä¾›äº†å†…ç½®çš„ DNS æœåŠ¡è§£æï¼Œå®ƒä¼šè‡ªåŠ¨å¤„ç†è¿™ç§æƒ…å†µã€‚</p> <p>ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„ Pod åœ¨å‘½åç©ºé—´ A ä¸­ï¼Œè¦è®¿é—®å‘½åç©ºé—´ B ä¸­çš„ Serviceï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å½¢å¼ï¼š</p> <div class="language-text extra-class"><pre class="language-text"><code>service-name.namespace-B
</code></pre></div><p>Kubernetes DNSä¼šè‡ªåŠ¨å°†è¿™ä¸ªåç§°è§£æä¸ºç›®æ ‡ Service çš„ IP åœ°å€ï¼Œå¹¶å°†æµé‡è·¯ç”±åˆ°æ­£ç¡®çš„ Serviceã€‚</p> <p>åœ¨æ—©æœŸç‰ˆæœ¬çš„ Kubernetes ä¸­ï¼Œéœ€è¦ä½¿ç”¨ .svc.cluster.local æ¥æ˜ç¡®æŒ‡å®š Service åç§°çš„å®Œå…¨é™å®šåŸŸåï¼Œä½†åœ¨è¾ƒæ–°çš„ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªåç¼€é€šå¸¸æ˜¯å¯é€‰çš„ï¼Œå› ä¸º Kubernetes DNSå·²ç»å˜å¾—æ›´åŠ æ™ºèƒ½ï¼Œèƒ½å¤Ÿè‡ªåŠ¨è§£æ Service åç§°ã€‚</p> <p>æ‰€ä»¥ï¼Œä½ å¯ä»¥æ ¹æ®ä½ çš„ Kubernetes ç‰ˆæœ¬å’Œé…ç½®æ¥ä½¿ç”¨ service-name.namespace æˆ– service-name.namespace.svc.cluster.localï¼Œä¸¤è€…éƒ½åº”è¯¥æœ‰æ•ˆï¼Œä½†é€šå¸¸æ¥è¯´ï¼Œå‰è€…æ›´ä¸ºç®€æ´å’Œå¸¸è§ã€‚</p> <h2 id="k8sä¸­ä½¿ç”¨apache-apisix"><a href="#k8sä¸­ä½¿ç”¨apache-apisix" class="header-anchor">#</a> k8sä¸­ä½¿ç”¨Apache-APISIX</h2> <p>å‚è€ƒï¼š</p> <p>https://apisix.apache.org/zh/blog/2021/12/15/deploy-apisix-in-kubernetes/</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/k8s/kubectl.html" class="prev">
        kubectl
      </a></span> <span class="next"><a href="/k8s/kind@v0.18.0.html">
        kind@v0.18.0
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.43768fea.js" defer></script><script src="/assets/js/2.d8080fc6.js" defer></script><script src="/assets/js/1.dbeab0c4.js" defer></script><script src="/assets/js/38.c44a0810.js" defer></script>
  </body>
</html>
