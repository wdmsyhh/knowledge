<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>kubectl | BLOG（更新中...）</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/assets/css/0.styles.bfaa3857.css" as="style"><link rel="preload" href="/assets/js/app.a5b48a0b.js" as="script"><link rel="preload" href="/assets/js/2.32a8373b.js" as="script"><link rel="preload" href="/assets/js/1.c3797433.js" as="script"><link rel="preload" href="/assets/js/40.16d51b2d.js" as="script"><link rel="prefetch" href="/assets/js/10.5a538a74.js"><link rel="prefetch" href="/assets/js/11.093c859f.js"><link rel="prefetch" href="/assets/js/12.13bf332d.js"><link rel="prefetch" href="/assets/js/13.0c950e44.js"><link rel="prefetch" href="/assets/js/14.226638bb.js"><link rel="prefetch" href="/assets/js/15.60316c8f.js"><link rel="prefetch" href="/assets/js/16.0dbd1595.js"><link rel="prefetch" href="/assets/js/17.a458e960.js"><link rel="prefetch" href="/assets/js/18.cda42bc1.js"><link rel="prefetch" href="/assets/js/19.857cc7ad.js"><link rel="prefetch" href="/assets/js/20.65bc3ecc.js"><link rel="prefetch" href="/assets/js/21.b5a6847d.js"><link rel="prefetch" href="/assets/js/22.665a31e0.js"><link rel="prefetch" href="/assets/js/23.8ffb5090.js"><link rel="prefetch" href="/assets/js/24.bca47b32.js"><link rel="prefetch" href="/assets/js/25.882352c7.js"><link rel="prefetch" href="/assets/js/26.3ba4d00f.js"><link rel="prefetch" href="/assets/js/27.49390b71.js"><link rel="prefetch" href="/assets/js/28.17a68ff4.js"><link rel="prefetch" href="/assets/js/29.87772818.js"><link rel="prefetch" href="/assets/js/3.2d969418.js"><link rel="prefetch" href="/assets/js/30.78d54562.js"><link rel="prefetch" href="/assets/js/31.bfcb2176.js"><link rel="prefetch" href="/assets/js/32.eec8c28e.js"><link rel="prefetch" href="/assets/js/33.d53cf199.js"><link rel="prefetch" href="/assets/js/34.98778802.js"><link rel="prefetch" href="/assets/js/35.1cdddb48.js"><link rel="prefetch" href="/assets/js/36.9b140408.js"><link rel="prefetch" href="/assets/js/37.3a906586.js"><link rel="prefetch" href="/assets/js/38.97d47ead.js"><link rel="prefetch" href="/assets/js/39.65bbc414.js"><link rel="prefetch" href="/assets/js/4.a139d787.js"><link rel="prefetch" href="/assets/js/41.d2994dfd.js"><link rel="prefetch" href="/assets/js/42.48ed8f87.js"><link rel="prefetch" href="/assets/js/43.b9a58482.js"><link rel="prefetch" href="/assets/js/44.31e4fbcc.js"><link rel="prefetch" href="/assets/js/45.fd35923b.js"><link rel="prefetch" href="/assets/js/46.f411b018.js"><link rel="prefetch" href="/assets/js/47.53ee3af9.js"><link rel="prefetch" href="/assets/js/48.550fc31b.js"><link rel="prefetch" href="/assets/js/49.2ee44a78.js"><link rel="prefetch" href="/assets/js/5.b22413f7.js"><link rel="prefetch" href="/assets/js/50.da20a6d5.js"><link rel="prefetch" href="/assets/js/51.d317e3f2.js"><link rel="prefetch" href="/assets/js/52.3eb35e9b.js"><link rel="prefetch" href="/assets/js/53.b2bf5736.js"><link rel="prefetch" href="/assets/js/54.4a21c2ca.js"><link rel="prefetch" href="/assets/js/55.b46667e7.js"><link rel="prefetch" href="/assets/js/56.c956ee68.js"><link rel="prefetch" href="/assets/js/57.5b9d124f.js"><link rel="prefetch" href="/assets/js/58.790b06d2.js"><link rel="prefetch" href="/assets/js/59.372f4c27.js"><link rel="prefetch" href="/assets/js/6.6cadd79a.js"><link rel="prefetch" href="/assets/js/60.95733c99.js"><link rel="prefetch" href="/assets/js/61.80a45bed.js"><link rel="prefetch" href="/assets/js/62.c311ab84.js"><link rel="prefetch" href="/assets/js/63.3402308d.js"><link rel="prefetch" href="/assets/js/64.47f3e134.js"><link rel="prefetch" href="/assets/js/65.2a5f3feb.js"><link rel="prefetch" href="/assets/js/66.a3a4462c.js"><link rel="prefetch" href="/assets/js/67.2f9c82fe.js"><link rel="prefetch" href="/assets/js/68.9872fc65.js"><link rel="prefetch" href="/assets/js/69.069d2a17.js"><link rel="prefetch" href="/assets/js/7.d105535e.js"><link rel="prefetch" href="/assets/js/70.eb8d309c.js"><link rel="prefetch" href="/assets/js/71.1c87992f.js"><link rel="prefetch" href="/assets/js/72.b38dd417.js"><link rel="prefetch" href="/assets/js/73.79bbd348.js"><link rel="prefetch" href="/assets/js/74.248407f4.js"><link rel="prefetch" href="/assets/js/75.5e93a648.js"><link rel="prefetch" href="/assets/js/76.fb4a4611.js"><link rel="prefetch" href="/assets/js/77.88e25bb9.js"><link rel="prefetch" href="/assets/js/78.80416a7f.js"><link rel="prefetch" href="/assets/js/79.e84811fb.js"><link rel="prefetch" href="/assets/js/80.0a7a3d01.js"><link rel="prefetch" href="/assets/js/81.5d0ee8c5.js"><link rel="prefetch" href="/assets/js/82.c0f57b73.js"><link rel="prefetch" href="/assets/js/83.c0a93357.js"><link rel="prefetch" href="/assets/js/84.737f6a1d.js"><link rel="prefetch" href="/assets/js/85.3ff0b026.js"><link rel="prefetch" href="/assets/js/86.796dcfc8.js"><link rel="prefetch" href="/assets/js/87.1fb5fc3b.js"><link rel="prefetch" href="/assets/js/88.9dbf8e83.js"><link rel="prefetch" href="/assets/js/89.b373aa62.js"><link rel="prefetch" href="/assets/js/90.fbddd1ac.js"><link rel="prefetch" href="/assets/js/91.edca0414.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.984e1063.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bfaa3857.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">BLOG（更新中...）</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  【Home】
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  【Home】
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/profile.html" class="sidebar-link">说明</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>系统</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/git/git.html" class="sidebar-link">Git</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开发工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Golang</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>gRPC</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据存储</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>消息队列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>API网关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>日志采集</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Jenkins</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Gitlab</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>K8s</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/k8s/kubectl.html" aria-current="page" class="active sidebar-link">kubectl</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s/kubectl.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/k8s/kubectl.html#使用" class="sidebar-link">使用</a></li><li class="sidebar-sub-header"><a href="/k8s/kubectl.html#常用命令" class="sidebar-link">常用命令</a></li></ul></li><li><a href="/k8s/kind@v0.11.0.html" class="sidebar-link">kind@v0.11.0</a></li><li><a href="/k8s/kind@v0.18.0.html" class="sidebar-link">kind@v0.18.0</a></li><li><a href="/k8s/minikube.html" class="sidebar-link">minikube</a></li><li><a href="/k8s/tencent.html" class="sidebar-link">腾讯云</a></li><li><a href="/k8s/helm.html" class="sidebar-link">helm</a></li><li><a href="/k8s/kubecm.html" class="sidebar-link">KubeCm</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>阿里云</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/开发工具/内网穿透.html" class="sidebar-link">内网穿透</a></li><li><a href="/chatgpt/chatgpt.html" class="sidebar-link">ChatGPT</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="kubectl"><a href="#kubectl" class="header-anchor">#</a> kubectl</h1> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <p><a href="https://kubernetes.io/zh-cn/docs/tasks/tools/install-kubectl-linux/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/zh-cn/docs/tasks/tools/install-kubectl-linux/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language- extra-class"><pre class="language-text"><code>curl -LO https://dl.k8s.io/release/v1.18.0/bin/linux/amd64/kubectl
</code></pre></div><p>或者在浏览器地址栏输入 <code>https://dl.k8s.io/release/v1.18.0/bin/linux/amd64/kubectl</code></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>注意版本和 k8s 的版本上下不要相差 1</p> <p>Before you begin
You must use a kubectl version that is within one minor version difference of your cluster. For example, a v1.28 client can communicate with v1.27, v1.28, and v1.29 control planes. Using the latest compatible version of kubectl helps avoid unforeseen issues.</p></div> <p>版本对应关系：<a href="https://github.com/kubernetes-sigs/kind/releases?page=2" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes-sigs/kind/releases?page=2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h2> <ul><li>查看版本</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 客户端版本</span>
kubectl version <span class="token parameter variable">--client</span>

<span class="token comment"># 客户端和服务端版本</span>
kubectl version
</code></pre></div><ul><li>查看集群信息</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl cluster-info
</code></pre></div><h2 id="常用命令"><a href="#常用命令" class="header-anchor">#</a> 常用命令</h2> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 部署应用</span>
kubectl apply <span class="token parameter variable">-f</span> app.yaml
<span class="token comment"># 查看 deployment</span>
kubectl get deployment
<span class="token comment"># 查看 pod</span>
kubectl get pod <span class="token parameter variable">-o</span> wide
<span class="token comment"># 查看 pod 详情</span>
kubectl describe pod pod-name
<span class="token comment"># 查看 log</span>
kubectl logs pod-name
<span class="token comment"># 进入 Pod 容器终端， -c container-name 可以指定进入哪个容器。</span>
kubectl <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> pod-name -- <span class="token function">bash</span>
<span class="token comment"># 伸缩扩展副本</span>
kubectl scale deployment test-k8s <span class="token parameter variable">--replicas</span><span class="token operator">=</span><span class="token number">5</span>
<span class="token comment"># 把集群内端口映射到节点</span>
kubectl port-forward pod-name <span class="token number">8090</span>:8080
<span class="token comment"># 查看历史</span>
kubectl rollout <span class="token function">history</span> deployment test-k8s
<span class="token comment"># 回到上个版本</span>
kubectl rollout undo deployment test-k8s
<span class="token comment"># 回到指定版本</span>
kubectl rollout undo deployment test-k8s --to-revision<span class="token operator">=</span><span class="token number">2</span>
<span class="token comment"># 删除部署</span>
kubectl delete deployment test-k8s
<span class="token comment"># 进入 pod 中的容器</span>
kubectl <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> pod-name <span class="token parameter variable">-c</span> container-name -- <span class="token function">bash</span>
<span class="token comment"># 删除所有服务</span>
kubectl delete all <span class="token parameter variable">--all</span>
<span class="token comment"># 查看 pods 默认是查看 default 命名空间的 pods</span>
kubectl get pods
<span class="token comment"># 查看指定命名空间的 pods</span>
kubectl get pods <span class="token parameter variable">-n</span> namespace
<span class="token comment"># 删除某个命名空间的 pods</span>
kubectl delete pods <span class="token parameter variable">--all</span> <span class="token parameter variable">-n</span> <span class="token operator">&lt;</span>namespace<span class="token operator">&gt;</span>

<span class="token comment"># 执行命令</span>
kubectl <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> muji-go-crm-tmp-job-5795f798bc-9tp7j -- /bin/sh <span class="token parameter variable">-c</span> <span class="token string">&quot;ls&quot;</span>

<span class="token comment"># 开两个窗口一个执行这个命令，另一个执行 kubectl log -f pod-name 查看日志可以看到输出 aaa</span>
kubectl <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> muji-go-crm-tmp-job-5795f798bc-9tp7j -- /bin/sh <span class="token parameter variable">-c</span> <span class="token string">&quot;echo aaa 2&gt;&amp;1 | tee /proc/1/fd/1&quot;</span>
</code></pre></div><ul><li>本地文件复制到pod中</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl <span class="token function">cp</span> <span class="token operator">&lt;</span>local-file-or-directory<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>namespace<span class="token operator">&gt;</span>/<span class="token operator">&lt;</span>pod-name<span class="token operator">&gt;</span>:<span class="token operator">&lt;</span>container-path<span class="token operator">&gt;</span>
<span class="token comment"># 例如</span>
kubectl <span class="token function">cp</span> gen_mobile_13000000000_to_13999999999_202407310950.csv muji-go-crm-tmp-job-5795f798bc-9tp7j:/app
</code></pre></div><ul><li>复制pod种文件到本地</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl <span class="token function">cp</span> <span class="token operator">&lt;</span>namespace<span class="token operator">&gt;</span>/<span class="token operator">&lt;</span>pod-name<span class="token operator">&gt;</span>:<span class="token operator">&lt;</span>container-path<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>local-file-or-directory<span class="token operator">&gt;</span>
<span class="token comment"># 例如</span>
kubectl <span class="token function">cp</span> muji-go-crm-tmp-job-5795f798bc-9tp7j:/app/gen_mobile_13000000000_to_13999999999_202407310950.csv ./gen_mobile_13000000000_to_13999999999_202407310950.csv
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在 Kubernetes 中，当你手动进入 Pod 并执行命令时，这些命令的输出通常不会被重定向到容器的标准输出或标准错误，因此 kubectl logs 无法捕获这些日志。不过，有一些方法可以让你在手动执行命令时，也能将日志输出到 kubectl logs 可以捕获的地方。</p></div> <ul><li>使用 kubectl exec 结合重定向</li></ul> <p>你可以使用 kubectl exec 来在容器内执行命令，并将输出重定向到标准输出或标准错误。这样，kubectl logs 可以捕获这些日志。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> <span class="token operator">&lt;</span>pod-name<span class="token operator">&gt;</span> -- /bin/sh <span class="token parameter variable">-c</span> <span class="token string">&quot;./app temp generate_mobile --env=test --tableName=mobile_tmall1 --worker=10 --num=200 --minMobile=13499999999 --maxMobile=13999999999 2&gt;&amp;1 | tee /proc/1/fd/1&quot;</span>
</code></pre></div><ul><li>启动一个临时容器并输出到标准输出</li></ul> <p>可以创建一个临时 Pod 或容器，专门用于执行你需要的命令，并确保输出到标准输出。</p> <p>临时 Pod 示例</p> <p>创建一个临时 Pod 配置文件 temp-job.yaml：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> batch/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Job
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> temp<span class="token punctuation">-</span>job
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> temp<span class="token punctuation">-</span>job<span class="token punctuation">-</span>container
        <span class="token key atrule">image</span><span class="token punctuation">:</span> your<span class="token punctuation">-</span>image
        <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/sh&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">]</span>
        <span class="token key atrule">args</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;./app temp generate_mobile --env=test --tableName=mobile_tmall1 --worker=10 --num=200 --minMobile=13499999999 --maxMobile=13999999999&quot;</span><span class="token punctuation">]</span>
      <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Never
</code></pre></div><p>应用这个配置：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl apply <span class="token parameter variable">-f</span> temp-job.yaml
</code></pre></div><p>然后你可以查看这个临时 Pod 的日志：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl logs <span class="token parameter variable">-f</span> job/temp-job
</code></pre></div><ul><li>可以通过创建临时 Pod</li></ul> <p>具体示例</p> <p>假设你有一个简单的 Go 程序 app.go，内容如下：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;log&quot;</span>
	<span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;生成手机号任务开始&quot;</span><span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;开始时间: %s\n&quot;</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>RFC3339Nano<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment">// 模拟工作</span>
	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;生成手机号任务结束&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Dockerfile:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>FROM golang:1.18-alpine
WORKDIR /app
COPY app.go <span class="token builtin class-name">.</span>
RUN go build <span class="token parameter variable">-o</span> app <span class="token builtin class-name">.</span>
CMD <span class="token punctuation">[</span><span class="token string">&quot;sh&quot;</span>, <span class="token string">&quot;-c&quot;</span>, <span class="token string">&quot;tail -f /dev/null&quot;</span><span class="token punctuation">]</span>
</code></pre></div><p>部署Pod:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> muji<span class="token punctuation">-</span>go<span class="token punctuation">-</span>crm<span class="token punctuation">-</span>temp<span class="token punctuation">-</span>job
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> muji<span class="token punctuation">-</span>go<span class="token punctuation">-</span>crm<span class="token punctuation">-</span>temp<span class="token punctuation">-</span>job<span class="token punctuation">-</span>container
    <span class="token key atrule">image</span><span class="token punctuation">:</span> your<span class="token punctuation">-</span>image<span class="token punctuation">:</span>latest
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;sh&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tail -f /dev/null&quot;</span><span class="token punctuation">]</span>  <span class="token comment"># 让容器保持运行</span>
</code></pre></div><p>然后使用 kubectl exec 在 Pod 内执行命令并重定向输出：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> muji-go-crm-temp-job -- /bin/sh <span class="token parameter variable">-c</span> <span class="token string">&quot;./app temp generate_mobile --env=test --tableName=mobile_tmall1 --worker=10 --num=200 --minMobile=13499999999 --maxMobile=13999999999 2&gt;&amp;1 | tee /proc/1/fd/1&quot;</span>
</code></pre></div><p>为了确保手动执行命令的日志能够被 kubectl logs 捕获，最简单的方法是使用 kubectl exec 结合重定向，将日志输出到标准输出或标准错误。此外，你也可以通过创建临时 Pod 或使用日志收集工具来实现这一目标。</p> <ul><li>直接在pod中执行并重定向</li></ul> <p><img src="/assets/img/image-111.829d3ee5.png" alt=""></p> <p>进入阿里云k8s集群，进入pod执行：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>./app temp generate_mobile <span class="token parameter variable">--env</span><span class="token operator">=</span>test <span class="token parameter variable">--tableName</span><span class="token operator">=</span>mobile_tmall1 <span class="token parameter variable">--worker</span><span class="token operator">=</span><span class="token number">10</span> <span class="token parameter variable">--num</span><span class="token operator">=</span><span class="token number">200</span> <span class="token parameter variable">--minMobile</span><span class="token operator">=</span><span class="token number">13000000000</span> <span class="token parameter variable">--maxMobile</span><span class="token operator">=</span><span class="token number">13000000099</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">|</span> <span class="token function">tee</span> /proc/1/fd/1
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/gitlab/mac.html" class="prev">
        Mac
      </a></span> <span class="next"><a href="/k8s/kind@v0.11.0.html">
        kind@v0.11.0
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a5b48a0b.js" defer></script><script src="/assets/js/2.32a8373b.js" defer></script><script src="/assets/js/1.c3797433.js" defer></script><script src="/assets/js/40.16d51b2d.js" defer></script>
  </body>
</html>
