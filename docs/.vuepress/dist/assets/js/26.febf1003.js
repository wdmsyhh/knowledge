(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{438:function(a,t,s){a.exports=s.p+"assets/img/image-1.3d189249.png"},439:function(a,t,s){a.exports=s.p+"assets/img/image-2.fc05ea63.png"},440:function(a,t,s){a.exports=s.p+"assets/img/image-3.9ced9d2f.png"},441:function(a,t,s){a.exports=s.p+"assets/img/image-4.3e8b464c.png"},520:function(a,t,s){"use strict";s.r(t);var e=s(17),n=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"journalbeat"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#journalbeat"}},[a._v("#")]),a._v(" journalbeat")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://www.elastic.co/guide/en/beats/journalbeat/7.10/journalbeat-installation-configuration.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://www.elastic.co/guide/en/beats/journalbeat/7.10/journalbeat-installation-configuration.html"),t("OutboundLink")],1)]),a._v(" "),t("h2",{attrs:{id:"使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[a._v("#")]),a._v(" 使用")]),a._v(" "),t("ul",[t("li",[a._v("下载")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-O")]),a._v(" https://artifacts.elastic.co/downloads/beats/journalbeat/journalbeat-7.10.2-linux-x86_64.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" xzvf journalbeat-7.10.2-linux-x86_64.tar.gz\n")])])]),t("ul",[t("li",[a._v("启动Elasticsearch和Kibana")])]),a._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),t("p",[a._v("注意版本需要与journalbeat保持一致。容器的方式启动设置在同一个 network: my_default")])]),a._v(" "),t("ul",[t("li",[a._v("修改配置journalbeat.yml")])]),a._v(" "),t("div",{staticClass:"language-yml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("journalbeat.inputs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" docker.service\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("paths")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("include_matches")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" _SYSTEMD_UNIT=docker.service\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("seek")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" tail\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("output.elasticsearch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'localhost:9200'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])])]),t("ul",[t("li",[a._v("启动journalbeat")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("./journalbeat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" journalbeat.yml\n")])])]),t("ul",[t("li",[a._v("指定container启动时的存储引擎（测试时候可以使用该方式）")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" journald_logging --log-driver journald hello-world\n")])])]),t("ul",[t("li",[a._v("更改docker的默认存储引擎（全部容器日志输出到journal）")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/docker/daemon.js\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 添加")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"log-driver"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"journald"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 重启docker服务")]),a._v("\nsystemctl restart "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v("\n")])])]),t("ul",[t("li",[a._v("启动测试日志容器")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" journald_logging --log-driver journald hello-world\n")])])]),t("ul",[t("li",[a._v("查看Kibana多了一个索引")])]),a._v(" "),t("p",[t("img",{attrs:{src:s(438),alt:""}})]),a._v(" "),t("ul",[t("li",[a._v("创建Index Pattern")])]),a._v(" "),t("p",[t("img",{attrs:{src:s(439),alt:""}})]),a._v(" "),t("ul",[t("li",[a._v("查看Discover")])]),a._v(" "),t("p",[t("img",{attrs:{src:s(440),alt:""}})]),a._v(" "),t("ul",[t("li",[a._v("重启容器再次查看")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" start journald_logging\n")])])]),t("h2",{attrs:{id:"使用docker方式启动journalbeat"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用docker方式启动journalbeat"}},[a._v("#")]),a._v(" 使用docker方式启动journalbeat")]),a._v(" "),t("h3",{attrs:{id:"测试步骤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试步骤"}},[a._v("#")]),a._v(" 测试步骤")]),a._v(" "),t("ul",[t("li",[a._v("启动一个容器")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("test-ubuntu "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--volume")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/var/log/journal:/var/log/journal"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--volume")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/etc/machine-id:/etc/machine-id"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--volume")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/run/systemd:/run/systemd"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--volume")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/etc/hostname:/etc/hostname:ro"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--net")]),a._v(" my_default "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  phusion/baseimage:focal-1.1.0\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 赋值journal到容器内根目录")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" journalbeat-7.10.2-linux-x86_64 test-ubuntu:/\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 进入容器")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" test-ubuntu "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 进入目录")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" journalbeat-7.10.2-linux-x86_64\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 修改配置")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" journalbeat.yml\n")])])]),t("p",[a._v("配置")]),a._v(" "),t("div",{staticClass:"language-yml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("journalbeat.inputs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" docker.service\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("paths")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("include_matches")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" _SYSTEMD_UNIT=docker.service\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("seek")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" cursor\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("output.elasticsearch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'elasticsearch:9200'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])])]),t("ul",[t("li",[a._v("修改journalbeat.yml所有者和所属组")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("chown")]),a._v(" root:root journalbeat.yml\n")])])]),t("ul",[t("li",[a._v("修改journalbeat")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("./journalbeat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" ./journalbeat.yml\n")])])]),t("ul",[t("li",[a._v("观察Kibana")])]),a._v(" "),t("p",[t("img",{attrs:{src:s(441),alt:""}})]),a._v(" "),t("ul",[t("li",[a._v("再次启动日志容器观察Kibana")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" start journald_logging\n")])])]),t("h3",{attrs:{id:"升级用法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级用法"}},[a._v("#")]),a._v(" 升级用法")]),a._v(" "),t("p",[a._v("可以使用容器的方式运行journalbeat采集日志到logstash，再通过logstash发送到日志服务（阿里云或腾讯云）")])])}),[],!1,null,null,null);t.default=n.exports}}]);